module.exports = (function() {
var __MODS__ = {};
var __DEFINE__ = function(modId, func, req) { var m = { exports: {}, _tempexports: {} }; __MODS__[modId] = { status: 0, func: func, req: req, m: m }; };
var __REQUIRE__ = function(modId, source) { if(!__MODS__[modId]) return require(source); if(!__MODS__[modId].status) { var m = __MODS__[modId].m; m._exports = m._tempexports; var desp = Object.getOwnPropertyDescriptor(m, "exports"); if (desp && desp.configurable) Object.defineProperty(m, "exports", { set: function (val) { if(typeof val === "object" && val !== m._exports) { m._exports.__proto__ = val.__proto__; Object.keys(val).forEach(function (k) { m._exports[k] = val[k]; }); } m._tempexports = val }, get: function () { return m._tempexports; } }); __MODS__[modId].status = 1; __MODS__[modId].func(__MODS__[modId].req, m, m.exports); } return __MODS__[modId].m.exports; };
var __REQUIRE_WILDCARD__ = function(obj) { if(obj && obj.__esModule) { return obj; } else { var newObj = {}; if(obj != null) { for(var k in obj) { if (Object.prototype.hasOwnProperty.call(obj, k)) newObj[k] = obj[k]; } } newObj.default = obj; return newObj; } };
var __REQUIRE_DEFAULT__ = function(obj) { return obj && obj.__esModule ? obj.default : obj; };
__DEFINE__(1657335106940, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib");tslib_1.__exportStar(require("./utils"),exports),tslib_1.__exportStar(require("./libs"),exports);
//# sourceMappingURL=index.js.map
}, function(modId) {var map = {"./utils":1657335106941,"./libs":1657335106942}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1657335106941, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0}),exports.getProductDateTemplate=exports.hmacSHA1=exports.md5=exports.downloadFile=exports.hexArrayTo128BleAdvertUUIDStr=exports.str2hexStr=exports.hex2str=exports.gen4BytesIntHex=exports.gen2BytesIntHex=exports.get8ByteFromStr=exports.U8ToHexString=exports.U16ToHexString=exports.U32ToHexString=void 0;var tslib_1=require("tslib"),qcloud_iotexplorer_appdev_sdk_1=require("qcloud-iotexplorer-appdev-sdk"),spark_md5_1=tslib_1.__importDefault(require("spark-md5")),_a=qcloud_iotexplorer_appdev_sdk_1.AppDevSdk.utils,noop=_a.noop,byteUtil=_a.byteUtil,CryptoJS=_a.CryptoJS;exports.U32ToHexString=function(t){var e=t.toString(16).toUpperCase();return""+"00000000".slice(0,8-e.length)+e},exports.U16ToHexString=function(t){var e=t.toString(16).toUpperCase();return""+"0000".slice(0,4-e.length)+e},exports.U8ToHexString=function(t){var e=t.toString(16).toUpperCase();if(e.length>2)throw"length error，must less then 255";return""+"00".slice(0,2-e.length)+e},exports.get8ByteFromStr=function(t){for(var e=exports.md5(t),r=byteUtil.hexStringToByteArray(e.substring(0,e.length/2)),o=byteUtil.hexStringToByteArray(e.substring(e.length/2)),n=[],s=0;s<r.length;s++)n[s]=r[s]^o[s];return byteUtil.byteArrayToHex(n)},exports.gen2BytesIntHex=function(){var t=Math.floor(Math.random()*Math.pow(10,4)).toString(16);return""+t+"feaa".slice(0,4-t.length)},exports.gen4BytesIntHex=function(){var t=Math.floor(Math.random()*Math.pow(10,9)).toString(16);return""+t+"feaa12dd".slice(0,8-t.length)},exports.hex2str=function(t){var e;return e="string"==typeof t?t.match(/[\da-f]{2}/gi):t,byteUtil.byteArrayToString(new Int8Array(e.map((function(t){return parseInt(t,16)}))))},exports.str2hexStr=function(t){return byteUtil.byteArrayToHex(byteUtil.stringToByteArray(t))},exports.hexArrayTo128BleAdvertUUIDStr=function(t){var e=tslib_1.__spread(t);return e.splice(4,0,"-"),e.splice(7,0,"-"),e.splice(10,0,"-"),e.splice(13,0,"-"),e.join("")},exports.downloadFile=function(t,e){var r=(void 0===e?{}:e).onProgress,o=void 0===r?noop:r;return new Promise((function(e){wx.downloadFile({url:t,success:function(t){console.log(t),wx.getFileSystemManager().readFile({filePath:t.tempFilePath,success:function(t){console.log(t);var r=t.data.byteLength;e({fileSize:r,fileBuffer:t.data})}})}}).onProgressUpdate((function(t){return o(t)}))}))},exports.md5=function(t){return spark_md5_1.default.hash(t)},exports.hmacSHA1=function(t,e){var r=CryptoJS.enc.Hex.parse(String(e)),o=CryptoJS.HmacSHA1(String(t),r);return console.log("encrypt",r,t,o.toString(CryptoJS.enc.Hex)),o.toString(CryptoJS.enc.Hex)},exports.getProductDateTemplate=function(t){try{if(!t)throw{code:"GET_PRODUCT_INFO_FAIL",msg:"获取产品信息失败"};var e=t.DataTemplate;return"string"==typeof e&&(e=JSON.parse(e)),e}catch(t){throw tslib_1.__assign({code:"TEMPLATE_ERROR"},t)}};
//# sourceMappingURL=index.js.map
}, function(modId) { var map = {}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1657335106942, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib");tslib_1.__exportStar(require("./bluetooth"),exports),tslib_1.__exportStar(require("./simple-queue"),exports);
//# sourceMappingURL=index.js.map
}, function(modId) { var map = {"./bluetooth":1657335106943,"./simple-queue":1657335106946}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1657335106943, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib");tslib_1.__exportStar(require("./tlvJson"),exports);
//# sourceMappingURL=index.js.map
}, function(modId) { var map = {"./tlvJson":1657335106944}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1657335106944, function(require, module, exports) {
var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.sliceData=exports.getTlvDataParser=exports.TlvDataTypeIndexMap=exports.convertActionOutputTlvToJsObject=exports.convertEventTlvToJsObject=exports.eventTlvData=exports.convertPropertiesChangeToTlv=exports.convertActionControlToTlv=exports.convertPropertiesTlvToJsObject=exports.tlvHex=exports.stringToTlv=exports.genHead=exports.getTypeHead=exports.getTypeIndexFromHead=exports.getTypeFromHead=exports.getStrLength=void 0;var tslib_1=require("tslib"),qcloud_iotexplorer_appdev_sdk_1=require("qcloud-iotexplorer-appdev-sdk"),constants=tslib_1.__importStar(require("./constants")),utils_1=require("../../../utils"),byteUtil=qcloud_iotexplorer_appdev_sdk_1.AppDevSdk.utils.byteUtil;exports.getStrLength=function(t){return parseInt(t.slice(0,2).join(""),16)},exports.getTypeFromHead=function(t){return parseInt(t,16)>>5},exports.getTypeIndexFromHead=function(t){return 31&parseInt(t,16)},exports.getTypeHead=function(t,e){return"string"==typeof t&&(t=parseInt(t,2)),"string"==typeof e&&(e=parseInt(e,2)),byteUtil.byteToHex(t<<5|31&e)},exports.genHead=function(t,e){var n=constants.TLV_TYPE_INDEX[t];return byteUtil.byteToHex(n<<5|31&e)},exports.stringToTlv=function(t){var e=""+utils_1.U16ToHexString(t.length)+byteUtil.byteArrayToHex(byteUtil.stringToByteArray(t));return byteUtil.hexString2hexArray(e)||[""]};var parseTlv=function(t){var e,n=t.type,o=t.tlvHex,a=t.hexIndex,r=t.needResolveType,s=void 0===r||r,T=constants.TLV_TYPE_LENGTH,l=constants.BLE_IOT_DATA_TYPE_BOOL,_=constants.BLE_IOT_DATA_TYPE_INT,c=constants.BLE_IOT_DATA_TYPE_ENUM,p=constants.BLE_IOT_DATA_TYPE_FLOAT,i=constants.BLE_IOT_DATA_TYPE_TIME,v=constants.BLE_IOT_DATA_TYPE_STRING,x=constants.BLE_IOT_DATA_TYPE_STRUCT,d=constants.BLE_IOT_DATA_TYPE_ARRAY;switch(s&&++a,n){case l:e=parseInt(o[a],16),a++;break;case i:case c:e=parseInt(o.slice(a,a+=T[n]).join(""),16);break;case p:e=parseFloat(""+byteUtil.hexArray2Float32(o.slice(a,a+=T[n]),3));break;case _:e=byteUtil.hex2Int32(o.slice(a,a+=T[n]));break;case v:var u=o.slice(a),I=exports.getStrLength(u);a+=2,u=o.slice(a,a+=I),e=utils_1.hex2str(u);break;case d:case x:u=o.slice(a),I=exports.getStrLength(u);a+=2,e=u=o.slice(a,a+=I)}return{hexIndex:a,value:e}},loopParseTlv=function(t,e,n,o){void 0===n&&(n=0),void 0===o&&(o=!1);for(var a={},r=n;r<e.length;){var s=exports.getTypeFromHead(e[r]),T=t[exports.getTypeIndexFromHead(e[r])];if(!T)throw{code:"ID_TEMPLATE_IS_NOT_EXIT"};var l=o?T.dataType.type:T.define.type;if(console.log("---type---",s,constants.TLV_TYPE_INDEX[l]),s!==constants.TLV_TYPE_INDEX[l])throw{code:"TYPE_IN_MODULE_IS_WRONG"};var _=parseTlv({type:l,tlvHex:e,hexIndex:r});if(r=_.hexIndex,l===constants.BLE_IOT_DATA_TYPE_ARRAY){for(var c=_.value||[],p=[],i=T.define.arrayInfo.type,v=0;v<c.length;){var x=parseTlv({type:i,tlvHex:c,hexIndex:v,needResolveType:!1}),d=x.hexIndex,u=x.value;v=d,i===constants.BLE_IOT_DATA_TYPE_STRUCT?p.push(loopParseTlv(T.define.arrayInfo.specs,u,0,!0)):p.push(u)}console.log("ARRAY",T,_,p),a[T.id]=p}else l===constants.BLE_IOT_DATA_TYPE_STRUCT?(console.log("STRUCT",T.define.specs,_.value),a[T.id]=loopParseTlv(T.define.specs,_.value,0,!0)):a[T.id]=_.value}return a},getIndexMap=function(t){var e={};return t.map((function(t,n){e[t.id]=n})),e},convertToTlv=function(t){var e=t.type,n=t.typeIndex,o=void 0===n?0:n,a=t.value,r=t.templateConfig,s=void 0===r?{}:r,T=t.needGenHead,l=void 0===T||T,_=constants.BLE_IOT_DATA_TYPE_BOOL,c=constants.BLE_IOT_DATA_TYPE_INT,p=constants.BLE_IOT_DATA_TYPE_ENUM,i=constants.BLE_IOT_DATA_TYPE_FLOAT,v=constants.BLE_IOT_DATA_TYPE_TIME,x=constants.BLE_IOT_DATA_TYPE_STRING,d=constants.BLE_IOT_DATA_TYPE_STRUCT,u=constants.BLE_IOT_DATA_TYPE_ARRAY,I=byteUtil.hexString2hexArray,E=byteUtil.int32ToHex,A=byteUtil.byteToHex,y=byteUtil.convertNumberToByte,g=[];switch(e){case _:g=[A(y(a))];break;case v:case c:g=I(E(a))||[""];break;case p:g=I(utils_1.U16ToHexString(a))||[""];break;case i:g=byteUtil.float32ToHexArray(parseFloat(a))||[""];break;case x:g=exports.stringToTlv(a);break;case d:var P=getIndexMap(s),D=loopConvertToTlv(a,P,s,!0).tlvData,O=D.length;g=tslib_1.__spread(byteUtil.hexString2hexArray(utils_1.U16ToHexString(O)),D);break;case u:var f=s[0],h=a;f&&Array.isArray(h)&&h.forEach((function(t){var e=convertToTlv({type:f.type,value:t,needGenHead:!1,templateConfig:f.type===d?f.specs:{}});g.push.apply(g,tslib_1.__spread(e))})),g=tslib_1.__spread(byteUtil.hexString2hexArray(utils_1.U16ToHexString(g.length)),g)}return l&&g.unshift(exports.genHead(e,o)),tslib_1.__spread(g)},loopConvertToTlv=function(t,e,n,o){void 0===o&&(o=!1);var a=[];Object.keys(t).forEach((function(r){var s=e[r],T=n[s]&&(o?n[s].dataType:n[s].define),l=null==T?void 0:T.type;if(!l)throw{code:"TEMPLATE_NOT_MATCH",detail:{jsObj:t,templateConfig:n}};var _=void 0;switch(l){case constants.BLE_IOT_DATA_TYPE_ARRAY:_=[n[s].define.arrayInfo];break;case constants.BLE_IOT_DATA_TYPE_STRUCT:_=n[s].define.specs;break;default:_={}}a[s]=convertToTlv({type:l,typeIndex:s,value:t[r],templateConfig:_})}));var r=[];return a.map((function(t){(null==t?void 0:t.length)&&r.push.apply(r,tslib_1.__spread(t))})),console.log("---tlvData---",r),{tlvData:r,tmpData:a}};exports.tlvHex=["00","00","81","00","00","22","00","00","00","00","43","00","0C","64","65","66","61","75","6C","74","20","6E","61","6D","65"],exports.convertPropertiesTlvToJsObject=function(t,e){var n=constants.TEMPLATE_PROPERTY;console.log("---tlvHex--",t);var o=e[n];if(!o)throw{code:"NO_SUCH_MODE_FOR_THIS_PRODUCT"};return loopParseTlv(o,t)},exports.convertActionControlToTlv=function(t,e){console.log("---convertActionControlToTlv--",t);var n=e[constants.TEMPLATE_ACTIONS],o=getIndexMap(n)[t.actionId],a=n[o],r=t.params,s=getIndexMap(a.input);console.log("---jsObj--",r,s);var T=loopConvertToTlv(r,s,a.input);return{actionIndex:o,tlvData:T.tlvData,tmpData:T.tmpData}},exports.convertPropertiesChangeToTlv=function(t,e){var n=constants.TEMPLATE_PROPERTY;console.log("---jsObj--",t,e);var o=e[n],a=getIndexMap(o),r=loopConvertToTlv(t,a,o),s=r.tlvData,T=r.tmpData;return console.warn("---tlvData---",s),console.warn("---tmpData---",T),{tlvData:s,tmpData:T}},exports.eventTlvData=["01","60","00","00","80","3F"],exports.convertEventTlvToJsObject=function(t,e){var n=constants.TEMPLATE_EVENTS,o=parseInt(t[0],16),a=e[n][o];if(!a)throw{code:"NO_SUCH_MODE_FOR_THIS_PRODUCT"};var r=loopParseTlv(a.params,t,1);return{eventId:a.id,eventIndex:o,params:r}},exports.convertActionOutputTlvToJsObject=function(t,e){var n=parseInt(t[0],16),o=e[constants.TEMPLATE_ACTIONS][n];if(!o)throw{code:"NO_SUCH_MODE_FOR_THIS_PRODUCT"};var a=loopParseTlv(o.output,t,1);return{actionId:o.id,actionIndex:n,outputParams:a}},exports.TlvDataTypeIndexMap=((_a={})[constants.PROPERTY_REPORT]=2,_a[constants.EVENT_REPORT]=3,_a[constants.ACTION_REPLY]=4,_a.default=2,_a),exports.getTlvDataParser=function(t){void 0===t&&(t="default");var e=[];return function(n){console.log("----data----",n);var o=exports.getStrLength(n),a=o>>14,r=o>>13&1,s=constants.SPLIT_MAP[a];switch(console.log(a,s,t),s){case constants.SPLIT_FIRST:return e=tslib_1.__spread(n.slice(2)),null;case constants.SPLIT_MIDDLE:return e=e.concat(n.slice(void 0!==exports.TlvDataTypeIndexMap[t]?exports.TlvDataTypeIndexMap[t]:2)),null;case constants.SPLIT_LAST:return(e=e.concat(n.slice(void 0!==exports.TlvDataTypeIndexMap[t]?exports.TlvDataTypeIndexMap[t]:2))).splice.apply(e,tslib_1.__spread([0,0],byteUtil.hexString2hexArray(utils_1.U16ToHexString(r<<15|e.length))||[])),console.log("----completeData---",e),e;case constants.NOT_SPLIT:return n}}},exports.sliceData=function(t,e){var n=e.head,o=e.mtu,a=(e.mode,[]),r=[],s=o-n.length-2;return t.forEach((function(t){if(t.length<s)r.push(t);else for(var e=0;e<t.length;e+=s)r.push(t.slice(e,e+s))})),r.forEach((function(t,e){var o,s=n.join("");o=0===e?constants.SPLIT_INDEX_MAP[constants.SPLIT_FIRST]:e===r.length-1?constants.SPLIT_INDEX_MAP[constants.SPLIT_LAST]:constants.SPLIT_INDEX_MAP[constants.SPLIT_MIDDLE],s+=utils_1.U16ToHexString(o<<14|t.length),s+=t.join(""),a.push(s)})),a};
//# sourceMappingURL=index.js.map
}, function(modId) { var map = {"./constants":1657335106945,"../../../utils":1657335106941}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1657335106945, function(require, module, exports) {
var _a,_b,_c;Object.defineProperty(exports,"__esModule",{value:!0}),exports.SPLIT_INDEX_MAP=exports.SPLIT_MAP=exports.SPLIT_LAST=exports.SPLIT_MIDDLE=exports.SPLIT_FIRST=exports.NOT_SPLIT=exports.TEMPLATE_ACTIONS=exports.TEMPLATE_EVENTS=exports.TEMPLATE_PROPERTY=exports.TLV_TYPE_LENGTH=exports.TLV_TYPE_INDEX=exports.BLE_IOT_DATA_TYPE_ARRAY=exports.BLE_IOT_DATA_TYPE_STRUCT=exports.BLE_IOT_DATA_TYPE_TIME=exports.BLE_IOT_DATA_TYPE_ENUM=exports.BLE_IOT_DATA_TYPE_FLOAT=exports.BLE_IOT_DATA_TYPE_STRING=exports.BLE_IOT_DATA_TYPE_INT=exports.BLE_IOT_DATA_TYPE_BOOL=exports.ACTION_REPLY=exports.EVENT_REPORT=exports.CONTROL_ACTION=exports.PROPERTY_REPORT=void 0,exports.PROPERTY_REPORT="PROPERTY_REPORT",exports.CONTROL_ACTION="CONTROL_ACTION",exports.EVENT_REPORT="EVENT_REPORT",exports.ACTION_REPLY="ACTION_REPLY",exports.BLE_IOT_DATA_TYPE_BOOL="bool",exports.BLE_IOT_DATA_TYPE_INT="int",exports.BLE_IOT_DATA_TYPE_STRING="string",exports.BLE_IOT_DATA_TYPE_FLOAT="float",exports.BLE_IOT_DATA_TYPE_ENUM="enum",exports.BLE_IOT_DATA_TYPE_TIME="timestamp",exports.BLE_IOT_DATA_TYPE_STRUCT="struct",exports.BLE_IOT_DATA_TYPE_ARRAY="array",exports.TLV_TYPE_INDEX=((_a={})[exports.BLE_IOT_DATA_TYPE_BOOL]=0,_a[exports.BLE_IOT_DATA_TYPE_INT]=1,_a[exports.BLE_IOT_DATA_TYPE_STRING]=2,_a[exports.BLE_IOT_DATA_TYPE_FLOAT]=3,_a[exports.BLE_IOT_DATA_TYPE_ENUM]=4,_a[exports.BLE_IOT_DATA_TYPE_TIME]=5,_a[exports.BLE_IOT_DATA_TYPE_STRUCT]=6,_a[exports.BLE_IOT_DATA_TYPE_ARRAY]=7,_a),exports.TLV_TYPE_LENGTH=((_b={})[exports.BLE_IOT_DATA_TYPE_BOOL]=1,_b[exports.BLE_IOT_DATA_TYPE_INT]=4,_b[exports.BLE_IOT_DATA_TYPE_FLOAT]=4,_b[exports.BLE_IOT_DATA_TYPE_ENUM]=2,_b[exports.BLE_IOT_DATA_TYPE_TIME]=4,_b),exports.TEMPLATE_PROPERTY="properties",exports.TEMPLATE_EVENTS="events",exports.TEMPLATE_ACTIONS="actions",exports.NOT_SPLIT="NOT_SPLIT",exports.SPLIT_FIRST="SPLIT_FIRST",exports.SPLIT_MIDDLE="SPLIT_MIDDLE",exports.SPLIT_LAST="SPLIT_LAST",exports.SPLIT_MAP={0:exports.NOT_SPLIT,1:exports.SPLIT_FIRST,2:exports.SPLIT_MIDDLE,3:exports.SPLIT_LAST},exports.SPLIT_INDEX_MAP=((_c={})[exports.NOT_SPLIT]=0,_c[exports.SPLIT_FIRST]=1,_c[exports.SPLIT_MIDDLE]=2,_c[exports.SPLIT_LAST]=3,_c);
//# sourceMappingURL=constants.js.map
}, function(modId) { var map = {}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1657335106946, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib");tslib_1.__exportStar(require("./SimpleQueue"),exports),tslib_1.__exportStar(require("./CancelableQueue"),exports);
//# sourceMappingURL=index.js.map
}, function(modId) { var map = {"./SimpleQueue":1657335106947,"./CancelableQueue":1657335106948}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1657335106947, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0}),exports.SimpleQueue=void 0;var tslib_1=require("tslib"),SimpleQueue=function(){function t(t){var s=t.autoStart,e=void 0===s||s,r=t.handler,n=t.onTaskSuccess,i=t.onTaskError;if(this.taskIdCount=0,this.inBusy=!1,this.startExecute=!1,this.runningTask=null,"function"!=typeof r)throw"params handler is not a function";this.autoStart=e,this.handler=r,this.onTaskSuccess=n,this.onTaskError=i,this.queue=[]}return t.prototype.push=function(t){var s=this.getTaskId();return this.queue.push({taskId:s,businessData:t}),this.autoStart&&this.start(),{taskId:s}},t.prototype.start=function(){this.startExecute=!0,this.consumeTask()},t.prototype.remove=function(t){var s=this.queue.findIndex((function(s){return s.taskId===t}));-1!==s&&this.queue.splice(s,1)},t.prototype.stop=function(){this.startExecute=!1},t.prototype.clear=function(){this.stop(),this.queue=[]},t.prototype.consumeTask=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var t,s,e;return tslib_1.__generator(this,(function(r){switch(r.label){case 0:if(!this.startExecute||this.inBusy||this.queue.length<=0)return[2];t=this.queue.shift(),this.inBusy=!0,this.runningTask=t,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.handler(t)];case 2:s=r.sent();try{"function"==typeof this.onTaskSuccess&&this.onTaskSuccess(t,s)}catch(t){}return[3,4];case 3:e=r.sent(),console.error("simple queue execute handler error",e);try{"function"==typeof this.onTaskError&&this.onTaskError(e,t)}catch(t){}return[3,4];case 4:return this.runningTask=null,this.inBusy=!1,this.consumeTask(),[2]}}))}))},t.prototype.getTaskId=function(){return String(++this.taskIdCount)},t}();exports.SimpleQueue=SimpleQueue;
//# sourceMappingURL=SimpleQueue.js.map
}, function(modId) { var map = {}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1657335106948, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0}),exports.CancelableQueue=void 0;var tslib_1=require("tslib"),SimpleQueue_1=require("./SimpleQueue"),CancelableQueue=function(e){function t(t){var n,u,i=e.call(this,tslib_1.__assign(tslib_1.__assign({},t),{handler:function(e){return i.handleCancelableTask(t.handler,e)}}))||this;return i.timeout=null,i.timeoutCode=null,i.timeout=null!==(n=t.timeout)&&void 0!==n?n:null,i.timeoutCode=null!==(u=t.timeoutCode)&&void 0!==u?u:null,i}return tslib_1.__extends(t,e),t.prototype.push=function(e){var t,n=this.getTaskId(),u=!1,i=new Promise((function(e,n){t=function(e){u=!0,n(e)}}));return this.queue.push({taskId:n,businessData:e,cancel:t,cancelPromise:i,isCancelled:function(){return u}}),this.autoStart&&this.start(),{taskId:n,cancel:t}},t.prototype.cancelAllTasks=function(e){this.runningTask&&this.runningTask.cancel(e),this.queue.forEach((function(t){t.cancel(e)}))},t.prototype.handleCancelableTask=function(e,t){var n=this;if(t.isCancelled())return t.cancelPromise;var u=e(t),i=[t.cancelPromise,u];if(null!==this.timeout){var l,a=new Promise((function(e,t){l=setTimeout((function(){t({code:n.timeoutCode})}),n.timeout)})),r=function(){clearTimeout(l)};return Promise.race(i).then(r,r),Promise.race(tslib_1.__spread([a],i))}return Promise.race(i)},t}(SimpleQueue_1.SimpleQueue);exports.CancelableQueue=CancelableQueue;
//# sourceMappingURL=CancelableQueue.js.map
}, function(modId) { var map = {"./SimpleQueue":1657335106947}; return __REQUIRE__(map[modId], modId); })
return __REQUIRE__(1657335106940);
})()
//# sourceMappingURL=index.js.map