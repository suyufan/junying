module.exports = (function() {
var __MODS__ = {};
var __DEFINE__ = function(modId, func, req) { var m = { exports: {}, _tempexports: {} }; __MODS__[modId] = { status: 0, func: func, req: req, m: m }; };
var __REQUIRE__ = function(modId, source) { if(!__MODS__[modId]) return require(source); if(!__MODS__[modId].status) { var m = __MODS__[modId].m; m._exports = m._tempexports; var desp = Object.getOwnPropertyDescriptor(m, "exports"); if (desp && desp.configurable) Object.defineProperty(m, "exports", { set: function (val) { if(typeof val === "object" && val !== m._exports) { m._exports.__proto__ = val.__proto__; Object.keys(val).forEach(function (k) { m._exports[k] = val[k]; }); } m._tempexports = val }, get: function () { return m._tempexports; } }); __MODS__[modId].status = 1; __MODS__[modId].func(__MODS__[modId].req, m, m.exports); } return __MODS__[modId].m.exports; };
var __REQUIRE_WILDCARD__ = function(obj) { if(obj && obj.__esModule) { return obj; } else { var newObj = {}; if(obj != null) { for(var k in obj) { if (Object.prototype.hasOwnProperty.call(obj, k)) newObj[k] = obj[k]; } } newObj.default = obj; return newObj; } };
var __REQUIRE_DEFAULT__ = function(obj) { return obj && obj.__esModule ? obj.default : obj; };
__DEFINE__(1666529690770, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),qcloud_iotexplorer_appdev_plugin_wificonf_core_1=require("qcloud-iotexplorer-appdev-plugin-wificonf-core"),RealtekTask_1=require("./realtek/realtek/RealtekTask"),WifiConfStepCode=qcloud_iotexplorer_appdev_plugin_wificonf_core_1.constants.WifiConfStepCode,WifiConfStepDesp=qcloud_iotexplorer_appdev_plugin_wificonf_core_1.constants.WifiConfStepDesp,SimpeConfigWifiConf=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return tslib_1.__extends(i,e),i.prototype.doProtocol=function(e){return tslib_1.__awaiter(this,void 0,void 0,(function(){var i,o=this;return tslib_1.__generator(this,(function(t){switch(t.label){case 0:return[4,new RealtekTask_1.RealtekTask({apSsid:e.SSID,apBssid:e.BSSID,apPassword:e.password,logger:{info:function(e,i){void 0===i&&(i={}),o.onProgress({code:WifiConfStepCode.PROTOCOL_DETAIL,detail:{message:WifiConfStepCode.PROTOCOL_DETAIL+"("+WifiConfStepDesp[WifiConfStepCode.PROTOCOL_DETAIL]+": "+e+")",data:i}})},error:function(e){void 0===e&&(e={}),o.onError({code:"PROTOCOL_FAIL",detail:{error:e}})}}}).start()];case 1:return i=t.sent()||[],[2,{address:i.length&&i[i.length-1]&&i[i.length-1].remoteInfo.address}]}}))}))},i}(qcloud_iotexplorer_appdev_plugin_wificonf_core_1.WifiConfProtocolBase),Plugin=function(){function e(){}return e.install=function(e){e.plugins.wifiConfSimpleConfig={start:function(i){return new SimpeConfigWifiConf(e,tslib_1.__assign({wifiConfType:"SimpleConfig"},i)).start()}}},e}();exports.default=Plugin;
//# sourceMappingURL=index.js.map
}, function(modId) {var map = {"./realtek/realtek/RealtekTask":1666529690771}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1666529690771, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0}),exports.RealtekTask=void 0;var tslib_1=require("tslib"),SimpleConfig_1=require("./SimpleConfig"),RealtekTask=function(){function s(s){var t=s.apSsid,i=s.apBssid,e=s.apPassword,r=s.localIp,o=s.logger,n=void 0===o?console:o;this.ssid="",this.bssid="",this.password="",this.localIp="",this.logger=console,this.ssid=t,this.bssid=i,this.password=e,this.localIp=r||"192.168.0.1",this.logger=n}return s.prototype.start=function(){var s=this;return new Promise((function(t,i){return tslib_1.__awaiter(s,void 0,void 0,(function(){var s,e,r,o=this;return tslib_1.__generator(this,(function(n){switch(n.label){case 0:this.mTask&&(this.mTask=null),this.mTask=new SimpleConfig_1.SimpleConfig(this.ssid,this.bssid,this.password,this.localIp,this.logger),this.mTask.on("onError",(function(s){i(s)})),n.label=1;case 1:return n.trys.push([1,5,,6]),"android"!==wx.getSystemInfoSync().platform?[3,2]:(this.mTask.on("result",(function(s){var i;o.logger.info("simpleconfig succ: "+(null===(i=s[0])||void 0===i?void 0:i.inetAddress),{detail:s}),t(s)})),this.mTask.startInNoPromise(),[3,4]);case 2:return[4,this.mTask.start()];case 3:(s=n.sent()).length&&(this.logger.info("simpleconfig succ: "+(null===(r=s[0])||void 0===r?void 0:r.inetAddress),{detail:s}),t(s)),n.label=4;case 4:return[3,6];case 5:return e=n.sent(),i(e),[3,6];case 6:return[2]}}))}))}))},s.prototype.interrupt=function(){var s;null===(s=this.mTask)||void 0===s||s.interrupt(),this.mTask=null},s}();exports.RealtekTask=RealtekTask;
//# sourceMappingURL=RealtekTask.js.map
}, function(modId) { var map = {"./SimpleConfig":1666529690772}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1666529690772, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0}),exports.SimpleConfig=void 0;var tslib_1=require("tslib"),qcloud_iotexplorer_appdev_sdk_1=require("qcloud-iotexplorer-appdev-sdk"),SimpleConfigGenerator_1=require("../protocol/SimpleConfigGenerator"),realtekTaskParameter_1=require("../base/realtekTaskParameter"),byteUtil=qcloud_iotexplorer_appdev_sdk_1.AppDevSdk.utils.byteUtil,SimpleConfig=function(e){function t(t,r,i,s,o){var n=e.call(this)||this;return n.mIsSuc=!1,n.profileSendTimeMillis=4e4,n.profileSendTimeIntervalMs=50,n.mWaitUdpReceivingMillisecond=1e4,n.mExpectTaskResultCount=1,n.mRealtekResultList=[],n.mMacStrTaskSucCountMap=[],n.mThresholdSucBroadcastCount=1,n.logger=console,n.mIsCancelled=!1,n.mGenerator=new SimpleConfigGenerator_1.SimpleConfigGenerator(t,r,i,s,o),n.mGenerator.on("onError",(function(e){n.emit("onError",e),n.interrupt()})),o&&(n.logger=o),n}return tslib_1.__extends(t,e),t.prototype.start=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){return tslib_1.__generator(this,(function(e){switch(e.label){case 0:return this.mGenerator.mSocketServer.startServer(),this.__listenAsyn("promise"),[4,this.__execute()];case 1:return e.sent()?[2,this.__getEsptouchResultList()]:this.mIsCancelled?[3,3]:[4,qcloud_iotexplorer_appdev_sdk_1.AppDevSdk.utils.delay(this.mWaitUdpReceivingMillisecond)];case 2:e.sent(),this.mIsSuc||(this.emit("onError",{code:"PROTOCOL_TIMEOUT"}),this.interrupt()),e.label=3;case 3:return[2,this.__getEsptouchResultList()]}}))}))},t.prototype.__execute=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var e,t,r;return tslib_1.__generator(this,(function(i){switch(i.label){case 0:this.mGenerator.generate(),e=Date.now(),t=Date.now(),r=0,i.label=1;case 1:return!this.mIsCancelled&&t-e<this.profileSendTimeMillis?[4,this.mGenerator.sendSync({type:"promise"})]:[3,5];case 2:return i.sent(),[4,this.mGenerator.sendData({type:"promise"})];case 3:return i.sent(),[4,qcloud_iotexplorer_appdev_sdk_1.AppDevSdk.utils.delay(this.profileSendTimeIntervalMs)];case 4:return i.sent(),t=Date.now(),r++,this.logger.info("Config rounds: "+r),this.logger.info("Config Time Elapsed: "+(t-e)+"ms"),[3,1];case 5:return[2,this.mIsSuc]}}))}))},t.prototype.startInNoPromise=function(){var e=this;this.mGenerator.mSocketServer.startServer(),this.__listenAsyn("callback"),this.__executeInNoPromise(),setTimeout((function(){e.mIsSuc?e.mIsCancelled||e.emit("result",e.__getEsptouchResultList()):e.emit("onError",{code:"PROTOCOL_TIMEOUT"}),e.interrupt()}),this.mWaitUdpReceivingMillisecond+this.profileSendTimeMillis)},t.prototype.__executeInNoPromise=function(){var e=this;this.mGenerator.generate();var t=Date.now(),r=Date.now(),i=function(){e.mIsCancelled||r-t>e.profileSendTimeMillis||(r=Date.now(),e.mGenerator.sendSync({type:"callback",callback:function(){e.mGenerator.sendData({type:"callback",callback:function(){setTimeout((function(){i()}),e.profileSendTimeIntervalMs)}})}}))};i()},t.prototype.__listenAsyn=function(e){var t=this;this.mGenerator.mSocketServer.on("recieveCorrectMsg",(function(r){t.mIsCancelled||(t.logger.info("RECIEVE_MSG",r),function(e){var r=e.message,i=e.remoteInfo,s=i.size;realtekTaskParameter_1.UDPUcast.RecvBuf=new Int8Array(r);var o=new Int8Array(s);if(byteUtil.arrayCopy(realtekTaskParameter_1.UDPUcast.RecvBuf,0,o,0,s),t.logger.info("recvBuf: "+o+": "+s),s<9)return t.logger.error("invaid recvLent: "+s+", need lower then 9"),-1;var n=o[0];if(0!=(n&(realtekTaskParameter_1.SimpleConfigParam.BIT(7)|realtekTaskParameter_1.SimpleConfigParam.BIT(6))))return t.logger.error("ACK version not match\n"),-1;if(32!=(n&realtekTaskParameter_1.SimpleConfigParam.BIT(5)))return t.logger.error("Not response ACK\n"),-1;var a={obj:void 0,what:void 0};switch(31&n){case 0:var l=tslib_1.__read(t.mGenerator.handleCfgACK(o),3),u=l[0],c=l[1],m=l[2];return t.__putEsptouchResult(!u,c,m,i);case 1:a.obj=o,a.what=1,t.logger.info("revice module message",{detail:a});break;case 2:a.obj=o,a.what=2,t.logger.info("revice module message",{detail:a});break;case 3:a.obj=o,a.what=3,t.logger.info("revice module message",{detail:a});break;case 4:a.obj=o,a.what=4,t.logger.info("revice module message",{detail:a});break;default:t.logger.error("Unknow response")}t.interrupt()}(r),t.mIsSuc=t.mRealtekResultList.length>=t.mExpectTaskResultCount,t.mIsSuc&&(t.logger.info("__listenAsyn() finish",{detail:t.__getEsptouchResultList()}),"callback"===e&&t.emit("result",t.__getEsptouchResultList()),t.interrupt()))}))},t.prototype.__putEsptouchResult=function(e,t,r,i){var s=this.mMacStrTaskSucCountMap[t];if(null==s&&(s=0),++s,this.logger.info("PUT_REALTEK_RESULT:__putEsptouchResult(): count = "+s),this.mMacStrTaskSucCountMap[t]=s,s>=this.mThresholdSucBroadcastCount){for(var o=!1,n=0;n<this.mRealtekResultList.length;n++)if(this.mRealtekResultList[n].macStr===t){o=!0;break}if(!o){this.logger.info("PUT_REALTEK_RESULT:put one more result macStr = "+t+" , address = "+r+",the remoteInfo from weapp"+JSON.stringify(i));var a={isSuc:e,macStr:t,inetAddress:r||i.address,remoteInfo:i};this.mRealtekResultList.push(a)}}else this.logger.info("PUT_REALTEK_RESULT:__putEsptouchResult(): count = "+s+", isn't enough")},t.prototype.__getEsptouchResultList=function(){return this.logger.info("GET_RESULT",{data:this.mRealtekResultList}),this.mRealtekResultList},t.prototype.interrupt=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){return tslib_1.__generator(this,(function(e){return this.mIsCancelled||(this.mIsCancelled=!0,this.mGenerator.interrupt()),[2]}))}))},t}(qcloud_iotexplorer_appdev_sdk_1.AppDevSdk.utils.EventEmitter);exports.SimpleConfig=SimpleConfig;
//# sourceMappingURL=SimpleConfig.js.map
}, function(modId) { var map = {"../protocol/SimpleConfigGenerator":1666529690773,"../base/realtekTaskParameter":1666529690775}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1666529690773, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0}),exports.SimpleConfigGenerator=void 0;var tslib_1=require("tslib"),qcloud_iotexplorer_appdev_sdk_1=require("qcloud-iotexplorer-appdev-sdk"),qcloud_iotexplorer_appdev_plugin_wificonf_core_1=require("qcloud-iotexplorer-appdev-plugin-wificonf-core"),SimpleConfigData_1=require("./SimpleConfigData"),realtekTaskParameter_1=require("../base/realtekTaskParameter"),byteUtil=qcloud_iotexplorer_appdev_sdk_1.AppDevSdk.utils.byteUtil,arrayFill=qcloud_iotexplorer_appdev_plugin_wificonf_core_1.utils.arrayFill,UDPSocketClient=qcloud_iotexplorer_appdev_plugin_wificonf_core_1.utils.UDPSocketClient,UDPSocketServer=qcloud_iotexplorer_appdev_plugin_wificonf_core_1.utils.UDPSocketServer,SimpleConfigGenerator=function(e){function a(a,t,r,l,i){var s=e.call(this)||this;return s.mIsCancelled=!1,s.mDefaultMac="02:00:00:00:00:00",s.mEachPacketSendCounts=3,s.mPacketSendTimeIntervalMs=5,s.logger=console,console.log("inetAddress",l),s.mApBssid=t,s.mApSsid=a,s.mApPassword=r,s.mLocalIp=l,s.logger=i,s.init(),s}return tslib_1.__extends(a,e),a.prototype.init=function(){var e=this;this.resetSimpleConfig(),this.mSocketClient=new UDPSocketClient(realtekTaskParameter_1.SimpleConfigParam.UNICAST_SPORT),this.mSocketServer=new UDPSocketServer(this.mSocketClient.mSocket,realtekTaskParameter_1.SimpleConfigParam.WAIT_UDP_TOTAL_MILLISECOND),this.mSocketClient.on("udpSocketError",(function(a){var t=a.errMsg;console.error(t),e.emit("onError",{code:"UDP_ERROR",errMsg:t}),e.interrupt()}))},a.prototype.generate=function(){this.resetSimpleConfig(),this.setDefaultPin(""),this.setPin(""),this.setSSid(this.mApSsid),this.mApPassword&&this.setPassword(this.mApPassword),this.setIp(this.mLocalIp),this.configData.scGenRandom(),this.configData.generateKey(this.mDefaultMac),this.configData.encryptProfile()},a.prototype.resetSimpleConfig=function(){realtekTaskParameter_1.RtkSC.PlainTotalLen=256,arrayFill(realtekTaskParameter_1.RtkSC.PlainBuf,byteUtil.convertNumberToByte(0)),realtekTaskParameter_1.RtkSC.PlainCurrent=realtekTaskParameter_1.RtkSC.PlainBuf,realtekTaskParameter_1.RtkSC.PlainCurrentLen[0]=0,realtekTaskParameter_1.RecvACK.MaxCfgNum=0,arrayFill(realtekTaskParameter_1.RecvACK.Status,byteUtil.convertNumberToByte(0));for(var e=0;e<32;e++)arrayFill(realtekTaskParameter_1.RecvACK.Mac[e],byteUtil.convertNumberToByte(0)),arrayFill(realtekTaskParameter_1.RecvACK.Type[e],byteUtil.convertNumberToByte(0)),arrayFill(realtekTaskParameter_1.RecvACK.IPBuf[e],byteUtil.convertNumberToByte(0)),arrayFill(realtekTaskParameter_1.RecvACK.NameBuf[e],byteUtil.convertNumberToByte(0));realtekTaskParameter_1.RecvACK.IP=[],realtekTaskParameter_1.RecvACK.Name=[],this.mIsCancelled=!1,this.configData=new SimpleConfigData_1.SimpleConfigData},a.prototype.setSSid=function(e){null!==e&&(null===this.configData.scProfileAddSSID(realtekTaskParameter_1.RtkSC.PlainCurrent,realtekTaskParameter_1.RtkSC.PlainTotalLen,realtekTaskParameter_1.RtkSC.PlainCurrentLen,byteUtil.getBytesByString(e))&&this.logger.info("SSID is null"))},a.prototype.setPassword=function(e){null!==e&&(null===this.configData.scProfileAddPasswd(realtekTaskParameter_1.RtkSC.PlainCurrent,realtekTaskParameter_1.RtkSC.PlainTotalLen,realtekTaskParameter_1.RtkSC.PlainCurrentLen,byteUtil.getBytesByString(e))&&this.logger.info("password is null"))},a.prototype.setPin=function(e){null!==e&&e.length>0?(this.configData.Index=3,realtekTaskParameter_1.SimpleConfigParam.Local_PIN=e):(this.configData.Index=2,realtekTaskParameter_1.SimpleConfigParam.Local_PIN=realtekTaskParameter_1.SimpleConfigParam.Default_PIN)},a.prototype.setDefaultPin=function(e){null!==e&&e.length>0?realtekTaskParameter_1.SimpleConfigParam.Default_PIN=e:this.logger.info("Invalid PIN")},a.prototype.setIp=function(e){var a=this.configData.scProfileAddIP(realtekTaskParameter_1.RtkSC.PlainCurrent,realtekTaskParameter_1.RtkSC.PlainTotalLen,realtekTaskParameter_1.RtkSC.PlainCurrentLen,e);this.logger.info("IP is"+e),null==a&&this.logger.info("IP is null\n")},a.prototype.sendSync=function(e){for(var a=void 0===e?{}:e,t=a.type,r=void 0===t?"promise":t,l=a.callback,i=void 0===l?function(){}:l,s=this.configData.mcastUDPCreateSync(this.configData.Index,realtekTaskParameter_1.RtkSC.CryptLen[0]),n=[],o=0;o<9;o++){realtekTaskParameter_1.UDPMcast.SendLen=s[3*o];var k="239."+String(255&s[3*o])+"."+String(255&s[3*o+1])+"."+String(255&s[3*o+2]);this.configData.Flag&&(realtekTaskParameter_1.UDPMcast.IPAddr=k,n.push([realtekTaskParameter_1.UDPMcast.IPAddr,realtekTaskParameter_1.UDPMcast.SendLen]))}return this.sendUdp({type:r,callback:i,messages:n})},a.prototype.sendData=function(e){var a=void 0===e?{}:e,t=a.type,r=void 0===t?"promise":t,l=a.callback,i=void 0===l?function(){}:l,s=new Int8Array(6),n=[];s[0]=1,s[1]=0,s[2]=94;for(var o=0;o<realtekTaskParameter_1.RtkSC.CryptLen[0];o++)s[4]=0,s[3]=byteUtil.convertNumberToByte(o+9),realtekTaskParameter_1.UDPMcast.SendLen=o+9,s[5]=realtekTaskParameter_1.RtkSC.CryptBuf[o],s[4]=byteUtil.convertNumberToByte(realtekTaskParameter_1.SimpleConfigParam.CHECKSUM(s,6)),realtekTaskParameter_1.UDPMcast.IPAddr="239."+String(255&s[3])+"."+String(255&s[4])+"."+String(255&s[5]),n.push([realtekTaskParameter_1.UDPMcast.IPAddr,realtekTaskParameter_1.UDPMcast.SendLen]);return this.sendUdp({type:r,callback:i,messages:n})},a.prototype.sendUdp=function(e){var a=this,t=void 0===e?{}:e,r=t.type,l=void 0===r?"promise":r,i=t.callback,s=void 0===i?function(){}:i,n=t.messages,o=void 0===n?[]:n,k=function(e){if(e>=o.length||a.mIsCancelled)return s();var t=o[e],r=t[0],l=new Array(a.mEachPacketSendCounts);arrayFill(l,new Int8Array(t[1])),a.mSocketClient.sendDataSideBySide(l,0,l.length,r,realtekTaskParameter_1.UDPMcast.DestPort,a.mPacketSendTimeIntervalMs,(function(){k(e+1)}))};switch(l){case"promise":return new Promise((function(e,t){return tslib_1.__awaiter(a,void 0,void 0,(function(){var a,t;return tslib_1.__generator(this,(function(r){switch(r.label){case 0:a=0,r.label=1;case 1:return a<o.length&&!this.mIsCancelled?(t=new Array(this.mEachPacketSendCounts),arrayFill(t,new Int8Array(o[a][1])),[4,this.mSocketClient.sendData(t,0,t.length,o[a][0],realtekTaskParameter_1.UDPMcast.DestPort,this.mPacketSendTimeIntervalMs)]):[3,5];case 2:return r.sent(),[4,qcloud_iotexplorer_appdev_sdk_1.AppDevSdk.utils.delay(this.mPacketSendTimeIntervalMs)];case 3:r.sent(),r.label=4;case 4:return a++,[3,1];case 5:return e(),[2]}}))}))}));case"callback":return k(0)}},a.prototype.handleCfgACK=function(e){var a,t=0,r=0,l=e[1]<<8&65280|255&e[2];if(console.log("handleCfgACK: "+l),l<13)return this.logger.error("Received format error"),[-1];if(realtekTaskParameter_1.RecvACK.MaxCfgNum>32)return this.logger.error("Receive buf is full"),[-1];if(realtekTaskParameter_1.RecvACK.MaxCfgNum>0)for(t=0;t<realtekTaskParameter_1.RecvACK.MaxCfgNum;t++){for(var i=0;i<6;i++)e[3+i]===realtekTaskParameter_1.RecvACK.Mac[t][i]&&r++;if(6===r)break;r=0}for(a=0;a<4&&0===e[12+a];a++);var s="";if(4!==a&&null!=realtekTaskParameter_1.RecvACK.IP[t]&&realtekTaskParameter_1.RecvACK.IP[t].length>0){for(byteUtil.arrayCopy(e,3,realtekTaskParameter_1.RecvACK.Mac[t],0,6),a=0;a<6;a++)s+=byteUtil.convertByte2HexString(byteUtil.convertByte2Uint8(realtekTaskParameter_1.RecvACK.Mac[t][a])),a<5&&(s+=":");byteUtil.arrayCopy(e,12,realtekTaskParameter_1.RecvACK.IPBuf[t],0,4),realtekTaskParameter_1.RecvACK.IP[t]=byteUtil.convertByte2Uint8(realtekTaskParameter_1.RecvACK.IPBuf[t][0])+("."+byteUtil.convertByte2Uint8(realtekTaskParameter_1.RecvACK.IPBuf[t][1]))+"."+byteUtil.convertByte2Uint8(realtekTaskParameter_1.RecvACK.IPBuf[t][2])+"."+byteUtil.convertByte2Uint8(realtekTaskParameter_1.RecvACK.IPBuf[t][3]),this.logger.info("Refresh IP: "+realtekTaskParameter_1.RecvACK.IP[t]+" of MAC: "+s)}if(this.sendCfgAckPacket(),6===r)return[0,s,realtekTaskParameter_1.RecvACK.IP[t]];byteUtil.arrayCopy(e,3,realtekTaskParameter_1.RecvACK.Mac[realtekTaskParameter_1.RecvACK.MaxCfgNum],0,6),s="";for(var n=0;n<6;n++)s+=byteUtil.convertByte2HexString(byteUtil.convertByte2Uint8(realtekTaskParameter_1.RecvACK.Mac[realtekTaskParameter_1.RecvACK.MaxCfgNum][n])),n<5&&(s+=":");if(this.logger.info("Added MAC: "+s),l>7&&(realtekTaskParameter_1.RecvACK.Status[realtekTaskParameter_1.RecvACK.MaxCfgNum]=e[9]),l>9&&byteUtil.arrayCopy(e,10,realtekTaskParameter_1.RecvACK.Type[realtekTaskParameter_1.RecvACK.MaxCfgNum],0,2),l>13&&(byteUtil.arrayCopy(e,12,realtekTaskParameter_1.RecvACK.IPBuf[realtekTaskParameter_1.RecvACK.MaxCfgNum],0,4),realtekTaskParameter_1.RecvACK.IP[realtekTaskParameter_1.RecvACK.MaxCfgNum]=byteUtil.convertByte2Uint8(255&realtekTaskParameter_1.RecvACK.IPBuf[realtekTaskParameter_1.RecvACK.MaxCfgNum][0])+("."+byteUtil.convertByte2Uint8(255&realtekTaskParameter_1.RecvACK.IPBuf[realtekTaskParameter_1.RecvACK.MaxCfgNum][1]))+"."+byteUtil.convertByte2Uint8(255&realtekTaskParameter_1.RecvACK.IPBuf[realtekTaskParameter_1.RecvACK.MaxCfgNum][2])+"."+byteUtil.convertByte2Uint8(255&realtekTaskParameter_1.RecvACK.IPBuf[realtekTaskParameter_1.RecvACK.MaxCfgNum][3]),this.logger.info("IP: "+realtekTaskParameter_1.RecvACK.IP[realtekTaskParameter_1.RecvACK.MaxCfgNum]),this.sendCfgAckPacket()),l>14){byteUtil.arrayCopy(e,16,realtekTaskParameter_1.RecvACK.NameBuf[realtekTaskParameter_1.RecvACK.MaxCfgNum],0,64);var o="";try{o=byteUtil.utf8ByteArrayToString(realtekTaskParameter_1.RecvACK.NameBuf[realtekTaskParameter_1.RecvACK.MaxCfgNum])}catch(e){this.logger.error("Get device's name error",tslib_1.__assign({},e))}o.length>0?realtekTaskParameter_1.RecvACK.Name[realtekTaskParameter_1.RecvACK.MaxCfgNum]=o:realtekTaskParameter_1.RecvACK.Name[realtekTaskParameter_1.RecvACK.MaxCfgNum]=null,this.logger.info("Name: "+realtekTaskParameter_1.RecvACK.Name[realtekTaskParameter_1.RecvACK.MaxCfgNum])}return realtekTaskParameter_1.RecvACK.MaxCfgNum+=1,[0,s,realtekTaskParameter_1.RecvACK.IP[realtekTaskParameter_1.RecvACK.MaxCfgNum]]},a.prototype.sendCfgAckPacket=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var e,a;return tslib_1.__generator(this,(function(t){switch(t.label){case 0:if(e=new Int8Array(92),arrayFill(e,byteUtil.convertNumberToByte(0)),0,e[0]=byteUtil.convertNumberToByte(e[0]+0),0,e[0]=byteUtil.convertNumberToByte(e[0]+0),0,e[0]=byteUtil.convertNumberToByte(e[0]+4),e[1]=0,e[2]=90,e[3]=0,!(null!=realtekTaskParameter_1.RecvACK.IP[0]&&realtekTaskParameter_1.RecvACK.IP[0].length>0&&"0.0.0.0"!==realtekTaskParameter_1.RecvACK.IP[0]))return[3,4];realtekTaskParameter_1.UDPUcast.IPAddr=realtekTaskParameter_1.RecvACK.IP[0],realtekTaskParameter_1.UDPUcast.SendLen=e.length,realtekTaskParameter_1.UDPUcast.SendMsg=e,this.logger.info("UDPUnicastSend CFG ACK"),a=0,t.label=1;case 1:return a<8?[4,this.mSocketClient.sendData([realtekTaskParameter_1.UDPUcast.SendMsg],0,1,realtekTaskParameter_1.UDPUcast.IPAddr,realtekTaskParameter_1.UDPUcast.DestPort)]:[3,4];case 2:t.sent(),t.label=3;case 3:return a++,[3,1];case 4:realtekTaskParameter_1.UDPBcast.IPAddr="255.255.255.255",realtekTaskParameter_1.UDPBcast.SendLen=e.length,realtekTaskParameter_1.UDPBcast.SendMsg=e,this.logger.info("UDPBroadcastSend CFG ACK"),a=0,t.label=5;case 5:return a<8?[4,this.mSocketClient.sendData([realtekTaskParameter_1.UDPBcast.SendMsg],0,1,realtekTaskParameter_1.UDPBcast.IPAddr,realtekTaskParameter_1.UDPBcast.DestPort)]:[3,8];case 6:t.sent(),t.label=7;case 7:return a++,[3,5];case 8:return[2]}}))}))},a.prototype.interrupt=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){return tslib_1.__generator(this,(function(e){switch(e.label){case 0:return this.mIsCancelled?[2]:(this.mIsCancelled=!0,[4,qcloud_iotexplorer_appdev_sdk_1.AppDevSdk.utils.delay(300)]);case 1:return e.sent(),this.mSocketClient.interrupt(),[2]}}))}))},a}(qcloud_iotexplorer_appdev_sdk_1.AppDevSdk.utils.EventEmitter);exports.SimpleConfigGenerator=SimpleConfigGenerator;
//# sourceMappingURL=SimpleConfigGenerator.js.map
}, function(modId) { var map = {"./SimpleConfigData":1666529690774,"../base/realtekTaskParameter":1666529690775}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1666529690774, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0}),exports.SimpleConfigData=void 0;var qcloud_iotexplorer_appdev_sdk_1=require("qcloud-iotexplorer-appdev-sdk"),qcloud_iotexplorer_appdev_plugin_wificonf_core_1=require("qcloud-iotexplorer-appdev-plugin-wificonf-core"),realtekTaskParameter_1=require("../base/realtekTaskParameter"),_a=qcloud_iotexplorer_appdev_sdk_1.AppDevSdk.utils,byteUtil=_a.byteUtil,CryptoJS=_a.CryptoJS,formatInetAddr=qcloud_iotexplorer_appdev_plugin_wificonf_core_1.utils.formatInetAddr,arrayFill=qcloud_iotexplorer_appdev_plugin_wificonf_core_1.utils.arrayFill,SimpleConfigAES=qcloud_iotexplorer_appdev_plugin_wificonf_core_1.utils.SimpleConfigAES,SimpleConfigData=function(){function e(){this.SyncRandomNum=4,this.SyncRandomData=new Int8Array(4),console.log(realtekTaskParameter_1.SimpleConfigParam.Default_PIN),this.Flag=realtekTaskParameter_1.SimpleConfigParam.PATTERN_USING_UDP_SOCKET|realtekTaskParameter_1.SimpleConfigParam.PATTERN_VALID,this.Name=byteUtil.getBytesByString(realtekTaskParameter_1.SimpleConfigParam.DEFAULT_PATTERN_NAME)}return e.prototype.scAddTLV=function(e,t,r,a,o){var l=new Int8Array(1),i=new Int8Array(1);return l[0]=byteUtil.convertNumberToByte(0|r),i[0]=t,byteUtil.arrayCopy(i,0,e,o[0]+0,1),byteUtil.arrayCopy(l,0,e,o[0]+1,1),byteUtil.arrayCopy(a,0,e,o[0]+2,r),e},e.prototype.scProfileAddSSID=function(e,t,r,a){return r[0]+2+a.length>t?null:(e=this.scAddTLV(e,byteUtil.convertNumberToByte(1),a.length,a,r),r[0]+=2+a.length,console.log("ssid",e),e)},e.prototype.scProfileAddPasswd=function(e,t,r,a){return r[0]+2+a.length>t?null:(e=this.scAddTLV(e,byteUtil.convertNumberToByte(2),a.length,a,r),r[0]+=2+a.length,console.log("scProfileAddPasswd",e),e)},e.prototype.scProfileAddIP=function(e,t,r,a){var o=formatInetAddr(a);return r[0]+2+o.length>t?null:(e=this.scAddTLV(e,byteUtil.convertNumberToByte(3),o.length,o,r),r[0]+=6,console.log("scProfileAddIP",e),e)},e.prototype.scGenRandom=function(){for(var e=0;e<4;e++){var t=Math.floor(256*Math.random());this.SyncRandomData[e]=byteUtil.convertNumberToByte(255&t)}this.SyncRandomData=[100,-108,-3,-14]},e.prototype.generateKey=function(e){var t=new Int8Array(256),r=(new Int8Array(16),new Int8Array(6)),a=0;arrayFill(r,byteUtil.convertNumberToByte(0)),arrayFill(t,byteUtil.convertNumberToByte(0));for(var o=e.split(":"),l=0;l<o.length&&l<6;l++){var i=byteUtil.getBytesByString(o[l]);r[l]=byteUtil.convertNumberToByte(parseInt(String.fromCodePoint(i[0]))<<4|parseInt(String.fromCodePoint(i[1])))}if(byteUtil.arrayCopy(r,0,t,0,6),a+=6,realtekTaskParameter_1.RtkSC.HavePin)byteUtil.arrayCopy(realtekTaskParameter_1.RtkSC.PIN,0,t,a,8);else{var n=byteUtil.getBytesByString(realtekTaskParameter_1.SimpleConfigParam.Local_PIN);byteUtil.arrayCopy(n,0,t,a,n.length)}a+=realtekTaskParameter_1.SimpleConfigParam.Local_PIN.length;var y=byteUtil.getBytesByString(realtekTaskParameter_1.SimpleConfigParam.McastUDPBuffer);byteUtil.arrayCopy(y,0,t,a,realtekTaskParameter_1.SimpleConfigParam.McastUDPBuffer.length),a+=realtekTaskParameter_1.SimpleConfigParam.McastUDPBuffer.length,byteUtil.arrayCopy(this.SyncRandomData,0,t,a,4),a+=4;var s=CryptoJS.MD5(CryptoJS.lib.WordArray.create(t.slice(0,a)));byteUtil.hexStringToByteArray(s.toString(CryptoJS.enc.Hex)),byteUtil.arrayCopy(this.Name,0,t,a,this.Name.length),a+=this.Name.length,console.log("---buffer",byteUtil.convertBytes2Uint8s(t));var c=CryptoJS.algo.HMAC.create(CryptoJS.algo.SHA1,s);c.update(CryptoJS.lib.WordArray.create(t.slice(0,a)));var p=c.finalize();realtekTaskParameter_1.RtkSC.KeyBuf=byteUtil.hexStringToByteArray(p.toString(CryptoJS.enc.Hex)).slice(0,realtekTaskParameter_1.RtkSC.KeyBuf.length),console.log("---key -buf-",byteUtil.convertBytes2Uint8s(realtekTaskParameter_1.RtkSC.KeyBuf)),realtekTaskParameter_1.RtkSC.KeyLen=16},e.prototype.encryptProfile=function(){var e=new Int8Array(8);if(arrayFill(e,byteUtil.convertNumberToByte(-90)),0!=(this.Flag&realtekTaskParameter_1.SimpleConfigParam.PATTERN_USING_PLAIN))return byteUtil.arrayCopy(realtekTaskParameter_1.RtkSC.PlainBuf,0,realtekTaskParameter_1.RtkSC.KeyBuf,0,realtekTaskParameter_1.RtkSC.PlainCurrentLen[0]),void(realtekTaskParameter_1.RtkSC.CryptLen[0]=realtekTaskParameter_1.RtkSC.PlainCurrentLen[0]);var t=realtekTaskParameter_1.RtkSC.PlainCurrentLen[0];t+=16-t%16;var r=byteUtil.convertBytes2Uint8s(realtekTaskParameter_1.RtkSC.PlainBuf.slice(0,t)),a=byteUtil.convertBytes2Uint8s(realtekTaskParameter_1.RtkSC.KeyBuf),o=byteUtil.convertBytes2Uint8s(e);console.log("---",r,a,o),realtekTaskParameter_1.RtkSC.CryptLen[0]=SimpleConfigAES(r,t,o,o.length,a,a.length,realtekTaskParameter_1.RtkSC.CryptBuf),console.log("---",byteUtil.convertBytes2Uint8s(realtekTaskParameter_1.RtkSC.CryptBuf),realtekTaskParameter_1.RtkSC.CryptLen[0])},e.prototype.mcastUDPCreateSync=function(e,t){var r=new Int8Array(32),a="\0".charCodeAt(),o=[0,0,0,0,0,0],l=[0,0,0];l[0]=1,l[1]=0,l[2]=94;for(var i=r,n="\0".charCodeAt();n<"\t".charCodeAt();n="".charCodeAt()+n)arrayFill(o,byteUtil.convertNumberToByte(0)),byteUtil.arrayCopy(l,0,o,0,3),o[3]=byteUtil.convertUint8toByte(a),n<="".charCodeAt()?o[5]=byteUtil.convertUint8toByte(e>>8*("".charCodeAt()-n)&255):n==="".charCodeAt()?o[5]=byteUtil.convertNumberToByte(9+t):n==="".charCodeAt()?o[5]=byteUtil.convertNumberToByte(i[0]+i[4]+i[8]+i[11]):o[5]=this.SyncRandomData[n-"".charCodeAt()],o[4]=byteUtil.convertNumberToByte(realtekTaskParameter_1.SimpleConfigParam.CHECKSUM(o,6)),byteUtil.arrayCopy(o,3,r,n*"".charCodeAt(),3),a="".charCodeAt()+a;return r},e}();exports.SimpleConfigData=SimpleConfigData;
//# sourceMappingURL=SimpleConfigData.js.map
}, function(modId) { var map = {"../base/realtekTaskParameter":1666529690775}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1666529690775, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0}),exports.UDPUcast=exports.UDPMcast=exports.UDPBcast=exports.Flag=exports.RtkSC=exports.RecvACK=exports.SimpleConfigParam=void 0;var qcloud_iotexplorer_appdev_plugin_wificonf_core_1=require("qcloud-iotexplorer-appdev-plugin-wificonf-core"),arrayFill=qcloud_iotexplorer_appdev_plugin_wificonf_core_1.utils.arrayFill,SimpleConfigParam=function(){function n(){}return n.BIT=function(n){return 1<<n},n.PATTERN_VALID_$LI$=function(){return null==n.PATTERN_VALID&&(n.PATTERN_VALID=n.BIT(1)),n.PATTERN_VALID},n.PATTERN_HAS_END_$LI$=function(){return null==n.PATTERN_HAS_END&&(n.PATTERN_HAS_END=n.BIT(2)),n.PATTERN_HAS_END},n.PATTERN_USING_UDP_SOCKET_$LI$=function(){return null==n.PATTERN_USING_UDP_SOCKET&&(n.PATTERN_USING_UDP_SOCKET=n.BIT(3)),n.PATTERN_USING_UDP_SOCKET},n.PATTERN_USING_PLAIN_$LI$=function(){return null==n.PATTERN_USING_PLAIN&&(n.PATTERN_USING_PLAIN=n.BIT(4)),n.PATTERN_USING_PLAIN},n.IFACE_FLAG_T_$LI$=function(){return null==n.IFACE_FLAG_T&&(n.IFACE_FLAG_T=n.BIT(1)),n.IFACE_FLAG_T},n.IP_ADDR_T_$LI$=function(){return null==n.IP_ADDR_T&&(n.IP_ADDR_T=n.BIT(2)),n.IP_ADDR_T},n.NET_MASK_T_$LI$=function(){return null==n.NET_MASK_T&&(n.NET_MASK_T=n.BIT(3)),n.NET_MASK_T},n.HW_ADDR_T_$LI$=function(){return null==n.HW_ADDR_T&&(n.HW_ADDR_T=n.BIT(4)),n.HW_ADDR_T},n.CHECKSUM=function(n,r){for(var _="\0".charCodeAt(0),e=0;e<r;e++)_+=n[e];return _=(4294967295^_)+"".charCodeAt(0)},n.MAX_PATTERN_NUM=64,n.MAX_KEY_BUF_LEN=16,n.MAX_PROFILE_BUF_LEN=256,n.INTF_NAME_LEN=32,n.MAX_CLIENTS_NUM=32,n.PIN_LEN=8,n.TLV_T_BYTES=1,n.TLV_L_BYTES=1,n.TLV_T_L_BYTES=2,n.SC_NAME_LEN=32,n.TAG_SSID_SC=1,n.TAG_PASSWORD_SC=2,n.TAG_IP_SC=3,n.MULTICAST_SPORT=8863,n.MULTICAST_DPORT=18864,n.BROADCAST_SPORT=18864,n.BROADCAST_DPORT=18864,n.UNICAST_SPORT=8864,n.UNICAST_DPORT=8864,n.WAIT_UDP_TOTAL_MILLISECOND=6e4,n.MCAST_ADDR_PREFIX=239,n.SYNC_PKT_NUM=9,n.SEQ_IDX=3,n.CHECKSUM_IDX=4,n.PATTERN_ID_IDX=5,n.DATA_IDX=5,n.MAGIC_IDX0=3,n.MAGIC_IDX1=4,n.MAGIC_IDX2=5,n.MAGIC_IDX3=5,n.RANDOM_IDX=5,n.McastUDPBuffer="8CmT/ J(3_aE R_UFR}`mtwF=)Qfjtn^S_1/ffg<_C7yw's}?'_'n&2~Blm&_k?6",n.Default_PIN="57289961",n.DEFAULT_PATTERN_NAME="sc_mcast_udp",n.Index=2,n.Flag=0,n.Name=new Int8Array(32),n}();exports.SimpleConfigParam=SimpleConfigParam;var createArray=function(n,r){var _=new Array(n);return arrayFill(_,r),_},RecvACK=function(){function n(){}return n.MaxCfgNum=0,n.Mac=createArray(32,new Int8Array(6)),n.Status=new Array(32),n.Type=createArray(32,new Int8Array(2)),n.IPBuf=createArray(32,new Int8Array(4)),n.IP=[],n.NameBuf=createArray(32,new Int8Array(64)),n.Name=[],n}();exports.RecvACK=RecvACK;var RtkSC=function(){function n(){}return n.PlainCurrentLen_$LI$=function(){return null==n.PlainCurrentLen&&(n.PlainCurrentLen=[0]),n.PlainCurrentLen},n.IntfName_$LI$=function(){return null==n.IntfName&&(n.IntfName=function(n){for(var r=[];n-- >0;)r.push(0);return r}(32)),n.IntfName},n.KeyBuf_$LI$=function(){return null==n.KeyBuf&&(n.KeyBuf=function(n){for(var r=[];n-- >0;)r.push(0);return r}(16)),n.KeyBuf},n.CryptLen_$LI$=function(){return null==n.CryptLen&&(n.CryptLen=[0]),n.CryptLen},n.PIN_$LI$=function(){return null==n.PIN&&(n.PIN=[null,null,null,null,null,null,null,null]),n.PIN},n.PlainBuf=new Int8Array(256),n.PlainTotalLen=0,n.PlainCurrent=null,n.KeyLen=0,n.CryptBuf=new Int8Array(256),n.PatternIndex=0,n.MaxPatternNum=0,n.HavePin=null,n}();exports.RtkSC=RtkSC;var Flag=function(){function n(){}return n.Version=0,n.RequestFlag=0,n.ResponseFlag=32,n.Discover=0,n.SaveProf=1,n.DelProf=2,n.RenameDev=3,n.ReturnACK=4,n.CfgSuccessACK=0,n.DiscoverACK=1,n.SaveProfACK=2,n.DelProfACK=3,n.RenameDevACK=4,n.CfgSuccessACKSendBack=5,n}();exports.Flag=Flag;var UDPBcast=function(){function n(){}return n.IPAddr=null,n.SrcPort=18864,n.DestPort=18864,n.SendMsg=null,n.SendLen=0,n}();exports.UDPBcast=UDPBcast;var UDPMcast=function(){function n(){}return n.IPAddr=null,n.SrcPort=8863,n.DestPort=18864,n.SendMsg=null,n.SendLen=0,n.RequestIP="239.114.116.107",n}();exports.UDPMcast=UDPMcast;var UDPUcast=function(){function n(){}return n.IPAddr=null,n.SrcPort=8864,n.DestPort=8864,n.SendMsg=null,n.SendLen=0,n.RecvLen=0,n.MIN_ACK_LENGTH=9,n.RecvBuf=new Int8Array(256),n}();exports.UDPUcast=UDPUcast,RtkSC.PIN_$LI$(),RtkSC.CryptLen_$LI$(),RtkSC.KeyBuf_$LI$(),RtkSC.IntfName_$LI$(),RtkSC.PlainCurrentLen_$LI$(),SimpleConfigParam.HW_ADDR_T_$LI$(),SimpleConfigParam.NET_MASK_T_$LI$(),SimpleConfigParam.IP_ADDR_T_$LI$(),SimpleConfigParam.IFACE_FLAG_T_$LI$(),SimpleConfigParam.PATTERN_USING_PLAIN_$LI$(),SimpleConfigParam.PATTERN_USING_UDP_SOCKET_$LI$(),SimpleConfigParam.PATTERN_HAS_END_$LI$(),SimpleConfigParam.PATTERN_VALID_$LI$();
//# sourceMappingURL=realtekTaskParameter.js.map
}, function(modId) { var map = {}; return __REQUIRE__(map[modId], modId); })
return __REQUIRE__(1666529690770);
})()
//# sourceMappingURL=index.js.map