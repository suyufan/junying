module.exports = (function() {
var __MODS__ = {};
var __DEFINE__ = function(modId, func, req) { var m = { exports: {}, _tempexports: {} }; __MODS__[modId] = { status: 0, func: func, req: req, m: m }; };
var __REQUIRE__ = function(modId, source) { if(!__MODS__[modId]) return require(source); if(!__MODS__[modId].status) { var m = __MODS__[modId].m; m._exports = m._tempexports; var desp = Object.getOwnPropertyDescriptor(m, "exports"); if (desp && desp.configurable) Object.defineProperty(m, "exports", { set: function (val) { if(typeof val === "object" && val !== m._exports) { m._exports.__proto__ = val.__proto__; Object.keys(val).forEach(function (k) { m._exports[k] = val[k]; }); } m._tempexports = val }, get: function () { return m._tempexports; } }); __MODS__[modId].status = 1; __MODS__[modId].func(__MODS__[modId].req, m, m.exports); } return __MODS__[modId].m.exports; };
var __REQUIRE_WILDCARD__ = function(obj) { if(obj && obj.__esModule) { return obj; } else { var newObj = {}; if(obj != null) { for(var k in obj) { if (Object.prototype.hasOwnProperty.call(obj, k)) newObj[k] = obj[k]; } } newObj.default = obj; return newObj; } };
var __REQUIRE_DEFAULT__ = function(obj) { return obj && obj.__esModule ? obj.default : obj; };
__DEFINE__(1657335106820, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),iotexplorer_ui_dev_config_1=require("iotexplorer-ui-dev-config"),qcloud_iotexplorer_appdev_plugin_wificonf_core_1=require("qcloud-iotexplorer-appdev-plugin-wificonf-core"),qcloud_iotexplorer_appdev_sdk_1=require("qcloud-iotexplorer-appdev-sdk"),protocols_1=require("./protocols"),delay=qcloud_iotexplorer_appdev_sdk_1.AppDevSdk.utils.delay,WifiConfStepCode=qcloud_iotexplorer_appdev_plugin_wificonf_core_1.constants.WifiConfStepCode,WifiConfStepDesp=qcloud_iotexplorer_appdev_plugin_wificonf_core_1.constants.WifiConfStepDesp,WifiConfErrorMsg=qcloud_iotexplorer_appdev_plugin_wificonf_core_1.constants.WifiConfErrorMsg,protocols_2=require("./protocols");Object.defineProperty(exports,"BleComboDualModeDeviceAdapter",{enumerable:!0,get:function(){return protocols_2.BleComboDualModeDeviceAdapter}}),Object.defineProperty(exports,"BleComboDualModeDeviceAdapter4H5",{enumerable:!0,get:function(){return protocols_2.BleComboDualModeDeviceAdapter4H5}}),Object.defineProperty(exports,"BleComboEspDeviceAdapter",{enumerable:!0,get:function(){return protocols_2.BleComboEspDeviceAdapter}}),Object.defineProperty(exports,"BleComboLLSyncDeviceAdapter",{enumerable:!0,get:function(){return protocols_2.BleComboLLSyncDeviceAdapter}});var getBleComboProtoHandler=function(e){switch(e.wifiConfType){case iotexplorer_ui_dev_config_1.WifiConfType.BLEComboEsp:return new protocols_1.BleComboEspTask(e);case iotexplorer_ui_dev_config_1.WifiConfType.BLEComboLLSync:case iotexplorer_ui_dev_config_1.WifiConfType.DualMode:return new protocols_1.BleComboLLSyncTask(e);default:console.warn("没有找到 wifiConfType 对应的 bleComboHandler:",e.wifiConfType)}},BleComboPlugin=function(){function e(){}return e.install=function(e){e.plugins.wifiConfBleCombo={start:function(o){return tslib_1.__awaiter(this,void 0,void 0,(function(){var r,t,i,n,s,d,c,_,l,a,p,f,u,C,b,S,v,T,E=this;return tslib_1.__generator(this,(function(m){switch(m.label){case 0:r=o.onError,t=o.onProgress,i=o.onComplete,n=o.wifiConfToken,s=o.familyId,d=o.roomId,c=void 0===d?"":d,_=function(e){return void 0===e&&(e=1e3),tslib_1.__awaiter(E,void 0,void 0,(function(){return tslib_1.__generator(this,(function(o){switch(o.label){case 0:return[4,delay(e)];case 1:return o.sent(),[2]}}))}))},t({code:WifiConfStepCode.PROTOCOL_START,reportEvents:["配网","发送wifi"]}),m.label=1;case 1:m.trys.push([1,22,,23]),l=Date.now(),a=getBleComboProtoHandler(tslib_1.__assign(tslib_1.__assign({},o),{reporter:{info:function(e,o){void 0===o&&(o={}),t({code:WifiConfStepCode.PROTOCOL_DETAIL,detail:{message:WifiConfStepCode.PROTOCOL_DETAIL+"("+WifiConfStepDesp[WifiConfStepCode.PROTOCOL_DETAIL]+": "+e+")",data:o}})},error:function(e){r({code:"PROTOCOL_FAIL",detail:{error:e}})}}})),m.label=2;case 2:return m.trys.push([2,4,,5]),[4,a.start()];case 3:return m.sent(),[3,5];case 4:throw p=m.sent(),console.error(p),tslib_1.__assign({code:"PROTOCOL_FAIL"},p);case 5:return t({code:WifiConfStepCode.PROTOCOL_SUCCESS,detail:{timeCost:Date.now()-l},reportEvents:["发送wifi"]}),[4,_()];case 6:m.sent(),t({code:WifiConfStepCode.BUSINESS_START}),t({code:"BLE_SEND_TOKEN_START",detail:{data:{wifiConfToken:n}},reportEvents:["bleSendToken"]}),f=Date.now(),u=void 0,m.label=7;case 7:return m.trys.push([7,9,,10]),[4,a.sendToken()];case 8:return u=m.sent(),[3,10];case 9:throw C=m.sent(),tslib_1.__assign({code:"BLE_SEND_TOKEN_ERROR"},C);case 10:return[4,t({code:"BLE_SEND_TOKEN_SUCCESS",detail:{timeCost:Date.now()-f,response:u},reportEvents:["bleSendToken"]})];case 11:if(m.sent(),b=u.productId,S=u.deviceName,o.wifiConfType!==iotexplorer_ui_dev_config_1.WifiConfType.DualMode)return[3,17];m.label=12;case 12:return m.trys.push([12,15,,16]),[4,qcloud_iotexplorer_appdev_plugin_wificonf_core_1.queryTokenStateAndBind({token:o.wifiConfToken,productId:b,deviceName:S,familyId:s,roomId:c,onProgress:t,sdk:e,skipBind:!0,newTokenVersion:!1})];case 13:return m.sent(),[4,o.deviceAdapter.bindDevice({familyId:s,roomId:c})];case 14:return m.sent(),[3,16];case 15:throw v=m.sent(),tslib_1.__assign({code:"BLE_BIND_DEVICE_ERROR"},v);case 16:return[3,19];case 17:return[4,qcloud_iotexplorer_appdev_plugin_wificonf_core_1.queryTokenStateAndBind({token:o.wifiConfToken,productId:b,deviceName:S,familyId:s,roomId:c,onProgress:t,sdk:e,newTokenVersion:o.newTokenVersion})];case 18:m.sent(),m.label=19;case 19:return[4,t({code:WifiConfStepCode.BUSINESS_QUERY_TOKEN_STATE_SUCCESS,detail:{timeCost:Date.now()-f,response:u}})];case 20:return m.sent(),[4,_()];case 21:return m.sent(),i({productId:b,deviceName:S}),a.interrupt(),t({code:WifiConfStepCode.WIFI_CONF_SUCCESS,detail:{timeCost:Date.now()-l},reportEvents:["配网"]}),[3,23];case 22:return(T=m.sent())&&T.code in WifiConfErrorMsg&&(T.uiMsg=WifiConfErrorMsg[T.code]),t({code:WifiConfStepCode.WIFI_CONF_FAIL,detail:{error:T}}),r({code:WifiConfStepCode.WIFI_CONF_FAIL,detail:{error:T}}),[3,23];case 23:return[2]}}))}))}}},e}();exports.default=BleComboPlugin;
//# sourceMappingURL=index.js.map
}, function(modId) {var map = {"./protocols":1657335106821}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1657335106821, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib");tslib_1.__exportStar(require("./BleComboEsp"),exports),tslib_1.__exportStar(require("./BleComboLLSync"),exports),tslib_1.__exportStar(require("./BleComboDualMode"),exports);
//# sourceMappingURL=index.js.map
}, function(modId) { var map = {"./BleComboEsp":1657335106822,"./BleComboLLSync":1657335106827,"./BleComboDualMode":1657335106831}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1657335106822, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib");tslib_1.__exportStar(require("./BleComboEspDeviceAdapter"),exports),tslib_1.__exportStar(require("./BleComboEspTask"),exports);
//# sourceMappingURL=index.js.map
}, function(modId) { var map = {"./BleComboEspDeviceAdapter":1657335106823,"./BleComboEspTask":1657335106825}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1657335106823, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0}),exports.BleComboEspDeviceAdapter=void 0;var tslib_1=require("tslib"),qcloud_iotexplorer_bluetooth_adapter_1=require("qcloud-iotexplorer-bluetooth-adapter"),qcloud_iotexplorer_appdev_sdk_1=require("qcloud-iotexplorer-appdev-sdk"),constants=tslib_1.__importStar(require("./constants")),qcloud_iotexplorer_bluetooth_adapter_llsync_1=require("qcloud-iotexplorer-bluetooth-adapter-llsync"),_a=qcloud_iotexplorer_appdev_sdk_1.AppDevSdk.utils,envDetect=_a.envDetect,byteUtil=_a.byteUtil,hex2str=qcloud_iotexplorer_bluetooth_adapter_llsync_1.utils.hex2str,BleComboEspDeviceAdapter=function(t){function e(e){var n,i,s=t.call(this,e)||this;return s.version=0,s.supportSendSplitDataMinimumVersion=512,s.sequence=0,s.waitVersionReplyTimeout=3e3,s.waitCustomDataTimeout=3e4,s.waitWiFiStateTimeout=3e4,s.MODE_TYPE_MAP=((n={})[constants.REPORT_CONNECT_STATE_SUB_TYPE]="wifiConnectStateChange",n[constants.SEND_TOKEN_SUB_TYPE]="tokenStateChange",n[constants.MODULE_ERROR_LOG_REPORT_SUB_TYPE]="moduleLogReport",n),s.MODE_TYPE_MAP_V2=((i={})[constants.REPORT_CONNECT_STATE_SUB_TYPE_V2]="wifiConnectStateChange",i[constants.GET_CUSTOM_DATA_V2]="CustomDataReport",i[constants.VERSION_REPLY_V2]="versionReport",i),s.on("message",s.handleMessageToEmitEvent),s.on("disconnect",(function(){s.initSequence()})),s}return tslib_1.__extends(e,t),e.prototype.initSequence=function(){this.sequence=0},e.prototype.getSequence=function(){return this.sequence++},e.prototype.handleBLEMessage=function(t){var e=parseInt(t[0],16)>>2;return{type:0===this.version?this.MODE_TYPE_MAP[e]||this.MODE_TYPE_MAP_V2[e]:1===this.version?this.MODE_TYPE_MAP[e]:this.MODE_TYPE_MAP_V2[e],subType:e,data:t}},e.prototype.handleMessageToEmitEvent=function(t){var e=t.type,n=t.subType,i=t.data;this.emit(e,{subType:n,data:i})},e.prototype.connectDevice=function(e){return tslib_1.__awaiter(this,void 0,void 0,(function(){return tslib_1.__generator(this,(function(n){switch(n.label){case 0:return[4,t.prototype.connectDevice.call(this,e)];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,6,,7]),[4,this.getVersion()];case 3:return n.sent().version>=this.supportSendSplitDataMinimumVersion?[4,this.setMtu(constants.DEFAULT_MTU)]:[3,5];case 4:n.sent(),n.label=5;case 5:return[3,7];case 6:return n.sent(),[3,7];case 7:return[2]}}))}))},e.prototype.setMtu=function(t){return tslib_1.__awaiter(this,void 0,void 0,(function(){return tslib_1.__generator(this,(function(e){switch(e.label){case 0:return console.log("---set---mtu",t),envDetect.isIOS?[2]:[4,this.setBLEMTU({deviceId:this.deviceId,mtu:t})];case 1:return[2,e.sent()]}}))}))},e.prototype.buildBleData=function(t){var e=t.mode,n=t.subType,i=t.data,s=[],o=[];if(s[0]=n<<2|e,s[1]=constants.BLE_DATA_TYPE_P2E,s[2]>=255)throw{code:"BLE_GATT_SERVER_NEED_RESTART"};if(i instanceof Int8Array!=!0)throw{msg:"传入的数据用于组装BleData的格式不对，需要Int8Array"};if(i.length>=255)throw{code:"SSID_OR_PASSWORD_OVERLOAD"};if(this.version>=this.supportSendSplitDataMinimumVersion&&i.length>constants.DEFAULT_DATA_LENGTH_CONSIDER_MTU-4)for(var r=constants.DEFAULT_DATA_LENGTH_CONSIDER_MTU-4-2,a=0;a<i.length;a+=r){var c=Math.min(i.length-a,r),_=i.length-a;_-r>0?o.push(tslib_1.__spread([s[0],s[1]|constants.SPLIT_FLAG,this.getSequence(),c+2,_,0],i.slice(a,a+r))):o.push(tslib_1.__spread([s[0],s[1],this.getSequence(),c],i.slice(a)))}else s[2]=this.getSequence(),s[3]=i.length,0===i.length?s[4]=0:i.map((function(t){return s.push(t)})),o.push(s);return o},e.prototype.writeData=function(t){return tslib_1.__awaiter(this,void 0,void 0,(function(){var e;return tslib_1.__generator(this,(function(n){switch(n.label){case 0:e=0,n.label=1;case 1:return e<t.length?(console.log("===data===",e,t[e]),[4,this.write(byteUtil.byteArrayToHex(t[e]))]):[3,4];case 2:n.sent(),n.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))},e.prototype.getVersion=function(){var t=this;return new Promise((function(e,n){t.writeData(t.buildBleData({mode:constants.CONTROL_MODE,subType:constants.GET_VERSION_V2,data:new Int8Array([])})).catch((function(t){n(tslib_1.__assign(tslib_1.__assign({},t),{code:"WRITE_ERROR"}))}));var i=setTimeout((function(){n({code:"TIMEOUT"})}),t.waitVersionReplyTimeout);t.on("moduleLogReport",(function(){t.version=1,clearTimeout(i),e({version:t.version})})),t.on("versionReport",(function(n){var s=n.data;clearTimeout(i);var o=parseInt(s[3]);t.version=2===o?2:parseInt(s.slice(s.length-2).join(""),16),console.log("get---version--",t.version),e({version:t.version})}))}))},e.prototype.sendSwitchWiFi=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var t;return tslib_1.__generator(this,(function(e){switch(e.label){case 0:return t=this.buildBleData({mode:constants.CONTROL_MODE,subType:constants["STA_SUB_TYPE"+(this.version>1?"_V2":"")],data:new Int8Array([1])}),[4,this.writeData(t)];case 1:return e.sent(),[2,t]}}))}))},e.prototype.sendSsid=function(t){return tslib_1.__awaiter(this,void 0,void 0,(function(){var e;return tslib_1.__generator(this,(function(n){switch(n.label){case 0:return e=this.buildBleData({mode:constants.DATA_MODE,subType:constants["SSID_SUB_TYPE"+(this.version>1?"_V2":"")],data:byteUtil.getBytesByString(t)}),[4,this.writeData(e)];case 1:return n.sent(),[2,e]}}))}))},e.prototype.sendPassword=function(t){return tslib_1.__awaiter(this,void 0,void 0,(function(){var e;return tslib_1.__generator(this,(function(n){switch(n.label){case 0:return e=this.buildBleData({mode:constants.DATA_MODE,subType:constants["PASSWORD_SUB_TYPE"+(this.version>1?"_V2":"")],data:byteUtil.getBytesByString(t)}),[4,this.writeData(e)];case 1:return n.sent(),[2,e]}}))}))},e.prototype.getCustomData=function(t){var e=this,n=t.mode,i=t.subType,s=t.data;return new Promise((function(t,o){if(e.version>=2){var r=i===constants.SEND_TOKEN_SUB_TYPE?{cmdType:3,token:s}:{cmdType:4,log:"1"};s=JSON.stringify(r),i=constants.GET_CUSTOM_DATA_V2,n=constants.DATA_MODE,console.log("send data",i,n,s)}s instanceof Int8Array!=!0&&("string"==typeof s?s=byteUtil.getBytesByString(s):Array.isArray(s)&&(s=new Int8Array(s))),e.writeData(e.buildBleData({mode:n,subType:i,data:s})).catch((function(t){o(tslib_1.__assign(tslib_1.__assign({},t),{code:"WRITE_ERROR"}))}));var a=setTimeout((function(){o({code:"TIMEOUT"})}),e.waitCustomDataTimeout),c="";c=e.version<=1?i===constants.SEND_TOKEN_SUB_TYPE?"tokenStateChange":"moduleLogReport":"CustomDataReport";var _=[];e.on(c,(function(e){var n=e.data;if(clearTimeout(a),"14"!==n[1]){_=_.concat(n.slice(4));var i=hex2str(_);try{~i.indexOf("{")?t(JSON.parse(i)):t(i)}catch(t){return o(tslib_1.__assign({code:"ERROR"},t))}}else _=_.concat(n.slice(6))}))}))},e.prototype.getWifiConnectState=function(){var t=this;return new Promise((function(e,n){t.writeData(t.buildBleData({mode:constants.CONTROL_MODE,subType:constants["CONNECT_AP_SUB_TYPE"+(t.version>1?"_V2":"")],data:new Int8Array([])}));var i,s,o=setTimeout((function(){n({code:"TIMEOUT"})}),t.waitWiFiStateTimeout),r=[];t.on("wifiConnectStateChange",(function(t){var a,c=t.data;if(clearTimeout(o),void 0===i){i="14"===c[1].toString();var _=parseInt(c[i?7:5],16);if(_!==constants.CONNECT_WIFI_SUCCESS)return n({code:"ERROR",connectState:_})}if(i&&r.length){var u="14"===c[1].toString()?6:4;a=c.slice(u)}else{u=i?11:9;s=parseInt(c[u-1],16),a=c.length>u?c.slice(u):[]}(r=r.concat(a)).length!==s&&i||e(r)}))}))},e.serviceId="0000FFFF-0000-1000-8000-00805F9B34FB",e.PRODUCT_INITED=!0,e.BLECOMBO_ESP_PRODUCTID="BLECOMBO",e.deviceFilter=function(t){if(t.advertisServiceUUIDs&&t.advertisServiceUUIDs.find((function(t){return e.serviceId===t}))){var n=tslib_1.__assign(tslib_1.__assign({},t),{serviceId:e.serviceId,deviceName:"",productId:e.BLECOMBO_ESP_PRODUCTID});return n.name=n.localName,n}},e}(qcloud_iotexplorer_bluetooth_adapter_1.DeviceAdapter4Mp);exports.BleComboEspDeviceAdapter=BleComboEspDeviceAdapter;
//# sourceMappingURL=BleComboEspDeviceAdapter.js.map
}, function(modId) { var map = {"./constants":1657335106824}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1657335106824, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0}),exports.SPLIT_FLAG=exports.DEFAULT_DATA_LENGTH_CONSIDER_MTU=exports.DEFAULT_MTU=exports.SEND_TOKEN_SUCCESS=exports.CONNECT_WIFI_SUCCESS=exports.SEND_TOKEN_STATE=exports.CONNECT_WIFI_STATE=exports.STA_MODE=exports.BLE_DATA_TYPE_CHECK_MASK=exports.BLE_DATA_TYPE_E2P=exports.BLE_DATA_TYPE_P2E=exports.GET_CUSTOM_DATA_V2=exports.VERSION_REPLY_V2=exports.REPORT_CONNECT_STATE_SUB_TYPE_V2=exports.PASSWORD_SUB_TYPE_V2=exports.SSID_SUB_TYPE_V2=exports.MODULE_ERROR_LOG_REPORT_SUB_TYPE=exports.SEND_TOKEN_SUB_TYPE=exports.REPORT_CONNECT_STATE_SUB_TYPE=exports.PASSWORD_SUB_TYPE=exports.SSID_SUB_TYPE=exports.DATA_MODE=exports.GET_VERSION_V2=exports.GET_WIFI_CONNECT_STATE_V2=exports.CONNECT_AP_SUB_TYPE_V2=exports.STA_SUB_TYPE_V2=exports.GET_MODULE_LOG=exports.GET_VERSION=exports.GET_WIFI_CONNECT_STATE=exports.CONNECT_AP_SUB_TYPE=exports.STA_SUB_TYPE=exports.CONTROL_MODE=void 0,exports.CONTROL_MODE=0,exports.STA_SUB_TYPE=2,exports.CONNECT_AP_SUB_TYPE=3,exports.GET_WIFI_CONNECT_STATE=4,exports.GET_VERSION=6,exports.GET_MODULE_LOG=7,exports.STA_SUB_TYPE_V2=2,exports.CONNECT_AP_SUB_TYPE_V2=3,exports.GET_WIFI_CONNECT_STATE_V2=5,exports.GET_VERSION_V2=7,exports.DATA_MODE=1,exports.SSID_SUB_TYPE=2,exports.PASSWORD_SUB_TYPE=3,exports.REPORT_CONNECT_STATE_SUB_TYPE=4,exports.SEND_TOKEN_SUB_TYPE=5,exports.MODULE_ERROR_LOG_REPORT_SUB_TYPE=7,exports.SSID_SUB_TYPE_V2=2,exports.PASSWORD_SUB_TYPE_V2=3,exports.REPORT_CONNECT_STATE_SUB_TYPE_V2=15,exports.VERSION_REPLY_V2=16,exports.GET_CUSTOM_DATA_V2=19,exports.BLE_DATA_TYPE_P2E=0,exports.BLE_DATA_TYPE_E2P=1,exports.BLE_DATA_TYPE_CHECK_MASK=2,exports.STA_MODE=1,exports.CONNECT_WIFI_STATE=15,exports.SEND_TOKEN_STATE=0,exports.CONNECT_WIFI_SUCCESS=0,exports.SEND_TOKEN_SUCCESS=0,exports.DEFAULT_MTU=23,exports.DEFAULT_DATA_LENGTH_CONSIDER_MTU=18,exports.SPLIT_FLAG=16;
//# sourceMappingURL=constants.js.map
}, function(modId) { var map = {}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1657335106825, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0}),exports.BleComboEspTask=void 0;var tslib_1=require("tslib"),qcloud_iotexplorer_appdev_sdk_1=require("qcloud-iotexplorer-appdev-sdk"),constants_1=require("./constants"),BleComboTask_1=require("../BleComboTask"),_a=qcloud_iotexplorer_appdev_sdk_1.AppDevSdk.utils,byteUtil=_a.byteUtil,delay=_a.delay,BleComboEspTask=function(e){function t(t){return e.call(this,t)||this}return tslib_1.__extends(t,e),t.prototype.setWiFiMode=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var e;return tslib_1.__generator(this,(function(t){switch(t.label){case 0:return[4,this.deviceAdapter.sendSwitchWiFi()];case 1:return e=t.sent(),this.logger.info("sendSwitchWiFiSucc",{bleData:e}),[2]}}))}))},t.prototype.sendWiFiInfo=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var e,t;return tslib_1.__generator(this,(function(s){switch(s.label){case 0:return[4,this.deviceAdapter.sendSsid(this.ssid)];case 1:return e=s.sent(),this.logger.info("sendSsidSucc",{bleData:e}),[4,delay(this.sendDataInterval)];case 2:return s.sent(),[4,this.deviceAdapter.sendPassword(this.password)];case 3:return t=s.sent(),this.logger.info("sendPasswordSucc",{bleData:t}),[2]}}))}))},t.prototype.connectWifi=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var e,t,s;return tslib_1.__generator(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.deviceAdapter.getWifiConnectState()];case 1:if(e=i.sent(),t=byteUtil.byteArrayToHex(byteUtil.getBytesByString(this.ssid)).toUpperCase(),console.log("----ssidData",e),e.length&&e.join("")===t)return[2,e];throw{code:"BLE_WIFI_CONNECTION_ERROR",ssidData:e.join(""),correctSsidData:t};case 2:return s=i.sent(),console.error(s),[2,Promise.reject(tslib_1.__assign(tslib_1.__assign({},s),{code:"BLE_WIFI_CONNECTION_"+(s.code||"ERROR")}))];case 3:return[2]}}))}))},t.prototype.sendToken=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var e,t;return tslib_1.__generator(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this.deviceAdapter.getCustomData({mode:constants_1.DATA_MODE,subType:constants_1.SEND_TOKEN_SUB_TYPE,data:this.token})];case 1:return e=s.sent(),this.logger.info("deviceData",{deviceData:e}),this.interrupt(),[2,{productId:e.productId,deviceName:e.deviceName}];case 2:return t=s.sent(),[2,Promise.reject(tslib_1.__assign({code:"BLE_TOKEN_STATE_"+(t.code||"ERROR")},t))];case 3:return[2]}}))}))},t}(BleComboTask_1.BleComboTask);exports.BleComboEspTask=BleComboEspTask;
//# sourceMappingURL=BleComboEspTask.js.map
}, function(modId) { var map = {"./constants":1657335106824,"../BleComboTask":1657335106826}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1657335106826, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0}),exports.BleComboTask=void 0;var tslib_1=require("tslib"),qcloud_iotexplorer_appdev_sdk_1=require("qcloud-iotexplorer-appdev-sdk"),delay=qcloud_iotexplorer_appdev_sdk_1.AppDevSdk.utils.delay,BleComboTask=function(e){function t(t){var r=t.targetWifiInfo,s=t.wifiConfToken,i=void 0===s?"":s,o=t.deviceAdapter,n=t.reporter,a=e.call(this)||this;a.sequence=0,a.sendDataInterval=300;var d=r.SSID,c=r.password;return a.ssid=d,a.password=c||"",a.token=i,a.deviceAdapter=o,a.logger=n,a.processing=!1,a.logger.info("ssid/password",{data:d+"/"+c.replace(/^\w{3}/,"***")}),a}return tslib_1.__extends(t,e),t.prototype.start=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var e;return tslib_1.__generator(this,(function(t){switch(t.label){case 0:if(this.processing)return[2,Promise.reject({code:"PROCESSING_PLEASE_WAIT"})];this.processing=!0,t.label=1;case 1:return t.trys.push([1,8,,9]),console.info("[plugin]: start to set wifi mode"),[4,this.setWiFiMode()];case 2:return t.sent(),[4,delay(this.sendDataInterval)];case 3:return t.sent(),console.info("[plugin]: start to send wifi info"),[4,this.sendWiFiInfo()];case 4:return t.sent(),[4,delay(this.sendDataInterval)];case 5:return t.sent(),console.info("[plugin]: start to connect wifi"),[4,this.connectWifi()];case 6:return t.sent(),[4,delay(this.sendDataInterval)];case 7:return t.sent(),[3,9];case 8:return e=t.sent(),console.error(e),[2,Promise.reject({error:e})];case 9:return[2]}}))}))},t.prototype.interrupt=function(){this.processing=!1,this.deviceAdapter.disconnectDevice()},t}(qcloud_iotexplorer_appdev_sdk_1.AppDevSdk.utils.EventEmitter);exports.BleComboTask=BleComboTask;
//# sourceMappingURL=BleComboTask.js.map
}, function(modId) { var map = {}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1657335106827, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib");tslib_1.__exportStar(require("./BleComboLLSyncDeviceAdapter"),exports),tslib_1.__exportStar(require("./BleComboLLSyncTask"),exports);
//# sourceMappingURL=index.js.map
}, function(modId) { var map = {"./BleComboLLSyncDeviceAdapter":1657335106828,"./BleComboLLSyncTask":1657335106830}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1657335106828, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0}),exports.BleComboLLSyncDeviceAdapter4H5=exports.BleComboLLSyncDeviceAdapter=exports.BleComboLLSyncDeviceAdapterBase=exports.LLSyncComboConfig=void 0;var tslib_1=require("tslib"),qcloud_iotexplorer_appdev_sdk_1=require("qcloud-iotexplorer-appdev-sdk"),qcloud_iotexplorer_bluetooth_adapter_1=require("qcloud-iotexplorer-bluetooth-adapter"),qcloud_iotexplorer_bluetooth_adapter_llsync_1=require("qcloud-iotexplorer-bluetooth-adapter-llsync"),constants_1=require("./constants"),hex2str=qcloud_iotexplorer_bluetooth_adapter_llsync_1.utils.hex2str,U16ToHexString=qcloud_iotexplorer_bluetooth_adapter_llsync_1.utils.U16ToHexString,U8ToHexString=qcloud_iotexplorer_bluetooth_adapter_llsync_1.utils.U8ToHexString,arrayBufferToHexStringArray=qcloud_iotexplorer_bluetooth_adapter_1.blueToothHelper.arrayBufferToHexStringArray,byteUtil=qcloud_iotexplorer_appdev_sdk_1.AppDevSdk.utils.byteUtil;exports.LLSyncComboConfig={waitGetDeviceInfoTime:1e4,waitSetWiFiModeTime:1e4,waitSetWiFiInfoTime:1e4,waitSetWiFiConnectTime:7e4,waitSetWiFiTokenTime:6e4,waitDevLogInfoTime:1e4};var BleComboLLSyncDeviceAdapterBase=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.reporter={info:function(e,o){var r;void 0===e&&(e=""),void 0===o&&(o={});var _=o.message,n=void 0===_?"":_,l=tslib_1.__rest(o,["message"]),i=t,s=i.explorerDeviceId,a=i.deviceId,c=i.isConnected;null===(r=exports.BleComboLLSyncDeviceAdapter.options)||void 0===r||r.appDevSdk.reporter.info(qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.REPORT_EVENT_TYPE,{serviceId:exports.BleComboLLSyncDeviceAdapter.serviceId,message:n||(e&&qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.ACTION_DESC[e]?e+"("+qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.ACTION_DESC[e]+")":e),timeCost:l.timeCost||0,action:e,data:tslib_1.__assign({deviceId:s,bleDeviceId:a,isConnected:c},l)})},error:function(e,o){var r;void 0===e&&(e=""),void 0===o&&(o={});var _=o.error,n=tslib_1.__rest(o,["error"]),l=t,i=l.explorerDeviceId,s=l.deviceId,a=l.isConnected;_.code&&qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.ERROR_MESSAGES[_.code]&&(_.msg=qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.ERROR_MESSAGES[_.code]),null===(r=exports.BleComboLLSyncDeviceAdapter.options)||void 0===r||r.appDevSdk.reporter.error(qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.REPORT_EVENT_TYPE,{message:e&&qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.ERROR_MESSAGES[e]&&e+"("+qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.ERROR_MESSAGES[e]+"："+(_&&(_.message||_.errMsg||_.msg||_.code))+")",timeCost:n.timeCost||0,action:e,error:_,data:tslib_1.__assign(tslib_1.__assign({deviceId:i,bleDeviceId:s,isConnected:a},n),_)})}},t}return tslib_1.__extends(t,e),t.injectOptions=function(e){exports.BleComboLLSyncDeviceAdapter.options=e},t.prototype.notifyMessage=function(e){var t=void 0===e?{}:e,o=t.type,r=t.data;if("unknown"!==o)return console.log("check this in notifyMessage",this,{type:o,data:r}),this.emit(o,{type:o,data:r})},t.prototype.connectDevice=function(t){return tslib_1.__awaiter(this,void 0,void 0,(function(){return tslib_1.__generator(this,(function(o){switch(o.label){case 0:return[4,e.prototype.connectDevice.call(this,t)];case 1:return o.sent(),[4,this.afterConnectDevice()];case 2:return o.sent(),[2]}}))}))},t.prototype.afterConnectDevice=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var e,t,o,r,_;return tslib_1.__generator(this,(function(n){switch(n.label){case 0:return[4,this.getDeviceInfo()];case 1:if(e=n.sent(),t=e.version,o=e.mtu,r=e.needSetMtu,_=e.deviceName,this.deviceName=_,this.bleVersion=t,this.mtu=Math.max(constants_1.MIN_ATT_MTU,o)-constants_1.ATT_MTU_TO_LLSYNC_MTU_DELTA,this.reporter.info("CONNECT_DEVICE",{data:{version:t,mtu:o,needSetMtu:r,deviceName:_}}),!r)return[3,5];n.label=2;case 2:return n.trys.push([2,4,,5]),[4,this.setMtu(o)];case 3:return n.sent(),this.writeMtuResult("success"),[3,5];case 4:return n.sent(),this.writeMtuResult("fail"),[3,5];case 5:return[2,_]}}))}))},t.prototype.getDeviceInfo=function(){return this.writeAndWait4Response(qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.DEVICE_INFO_WRITE_PREFIX[qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.GET_DEVICE_INFO],qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.DEVICE_INFO,(function(e){if(!e.length)throw{code:qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.DEVICE_INFO_INVALID};var t=parseInt(e.slice(2,3).join(""),16),o=parseInt(e.slice(3,5).join(""),16),r=!!(o>>15),_=8191&o,n=parseInt(e[5],16),l=hex2str(e.slice(6).join(""));if(n!==l.length)throw{code:qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.DEVICE_INFO_INVALID};return{version:t,mtu:_,needSetMtu:r,deviceName:l}}),{timeout:exports.LLSyncComboConfig.waitGetDeviceInfoTime,timeoutCode:qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.WAIT_GET_DEVICE_INFO_TIMEOUT,writeId:qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.DEVICE_INFO_WRITE_ID})},t.prototype.setWiFiMode=function(e){void 0===e&&(e=qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.STA_WIFI_MODE);var t=""+qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.DEVICE_INFO_WRITE_PREFIX[qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.SET_WIFI_MODE]+U8ToHexString(qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.WIFI_MODE_MAP[e]);return this.writeAndWait4Response(t,qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.SET_WIFI_MODE_RESULT,(function(e){if(!e.length)throw{code:qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.SET_WIFI_MODE_RESULT_INVALID};return!parseInt(e.slice(2,3).join(""),16)}),{timeout:exports.LLSyncComboConfig.waitSetWiFiModeTime,timeoutCode:qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.SET_WIFI_MODE_RESULT_TIMEOUT,writeId:qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.DEVICE_INFO_WRITE_ID})},t.prototype.setWiFiInfo=function(e){var t=e.ssid,o=e.password,r=byteUtil.hexString2hexArray(byteUtil.byteArrayToHex(byteUtil.getBytesByString(t)))||[],_=byteUtil.hexString2hexArray(byteUtil.byteArrayToHex(byteUtil.getBytesByString(o)))||[];console.log("----data----",{ssid:t,password:o,ssidHexArray:r,passwordHexArray:_});var n=this.sliceData(tslib_1.__spread([qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.DEVICE_INFO_WRITE_PREFIX[qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.SET_WIFI_INFO],U16ToHexString(r.length+_.length),U8ToHexString(r.length)],r,[U8ToHexString(_.length)],_),[tslib_1.__spread([U8ToHexString(r.length)],r),tslib_1.__spread([U8ToHexString(_.length)],_)],qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.SET_WIFI_INFO);return this.writeAndWait4Response(n,qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.SET_WIFI_INFO_RESULT,(function(e){if(!e.length)throw{code:qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.SET_WIFI_INFO_RESULT_INVALID};return!parseInt(e.slice(2,3).join(""),16)}),{timeout:exports.LLSyncComboConfig.waitSetWiFiInfoTime,timeoutCode:qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.SET_WIFI_INFO_RESULT_TIMEOUT,writeId:qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.DEVICE_INFO_WRITE_ID})},t.prototype.sendConnectWiFiAndGetWiFiConnectState=function(){var e=""+qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.DEVICE_INFO_WRITE_PREFIX[qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.SET_WIFI_CONNECT];return this.writeAndWait4Response(e,qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.SET_WIFI_CONNECT_RESULT,(function(e){if(!e.length)throw{code:qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.SET_WIFI_CONNECT_RESULT_INVALID};var t=parseInt(e.slice(3,4).join(""),16),o=parseInt(e.slice(5,6).join(""),16),r="";return o&&(r=hex2str(e.slice(6,6+o))),{connected:!t,ssid:r}}),{timeout:exports.LLSyncComboConfig.waitSetWiFiConnectTime,timeoutCode:qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.SET_WIFI_CONNECT_RESULT_TIMEOUT,writeId:qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.DEVICE_INFO_WRITE_ID})},t.prototype.sendToken=function(e){var t=e.token,o=byteUtil.hexString2hexArray(byteUtil.byteArrayToHex(byteUtil.getBytesByString(t)));console.log("----data----",{token:t,tokenHexArray:o});var r=this.sliceData(tslib_1.__spread([qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.DEVICE_INFO_WRITE_PREFIX[qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.SET_WIFI_TOKEN],U16ToHexString(o.length)],o),[o],qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.SET_WIFI_TOKEN);return this.writeAndWait4Response(r,qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.SET_WIFI_TOKEN_RESULT,(function(e){if(!e.length)throw{code:qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.SET_WIFI_TOKEN_RESULT_INVALID};return!parseInt(e.slice(2,3).join(""),16)}),{timeout:exports.LLSyncComboConfig.waitSetWiFiTokenTime,timeoutCode:qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.SET_WIFI_TOKEN_RESULT_TIMEOUT,writeId:qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.DEVICE_INFO_WRITE_ID})},t.prototype.getModuleLog=function(){var e=""+qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.DEVICE_INFO_WRITE_PREFIX[qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.GET_DEV_LOG];return this.writeAndWait4Response(e,qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.GET_DEV_LOG_INFO,(function(e){if(!e.length)throw{code:qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.GET_DEV_LOG_INFO_INVALID};var t=parseInt(e.slice(1,3).join(""),16);return{logStr:hex2str(e.slice(4,4+t))}}),{timeout:exports.LLSyncComboConfig.waitDevLogInfoTime,timeoutCode:qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.GET_DEV_LOG_INFO_TIMEOUT,writeId:qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.DEVICE_INFO_WRITE_ID})},t.options=null,t.serviceId16="0000FFF0-0000-1000-8000-00805F9B34FB",t.serviceId="0000FFF0-65D0-4E20-B56A-E493541BA4E2",t.deviceFilter=function(e){var t,o,r;if(!e.advertisServiceUUIDs||!e.advertisServiceUUIDs.find((function(e){return e===exports.BleComboLLSyncDeviceAdapter.serviceId16}))||!e.advertisData)return null;try{var _=Math.floor(10*Math.random())%10==1||!0,n=arrayBufferToHexStringArray(e.advertisData);_&&(null===(t=exports.BleComboLLSyncDeviceAdapter.options)||void 0===t||t.appDevSdk.reporter.info(qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.REPORT_EVENT_TYPE,{message:"收到广播",serviceId:exports.BleComboLLSyncDeviceAdapter.serviceId,hexArr:n.join(",")}));var l,i=parseInt(n[2],16)>>4,s=n.slice(3,9),a=e.localName||e.name;return a&&-1===a.indexOf("_")&&(a=a+"_"+s.slice(0,2).join("")),l=hex2str(n.slice(9)),_&&(null===(o=exports.BleComboLLSyncDeviceAdapter.options)||void 0===o||o.appDevSdk.reporter.info(qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.REPORT_EVENT_TYPE,{message:"解析广播",serviceId:exports.BleComboLLSyncDeviceAdapter.serviceId,data:{deviceProductId:l||"x"}})),tslib_1.__assign(tslib_1.__assign({},e),{standardBleCombo:!0,serviceId:exports.BleComboLLSyncDeviceAdapter.serviceId,deviceName:"",productId:l,extendInfo:{moduleVersion:i},name:a})}catch(e){null===(r=exports.BleComboLLSyncDeviceAdapter.options)||void 0===r||r.appDevSdk.reporter.error(qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.REPORT_EVENT_TYPE,{message:"协议广播出错",error:e})}},t}(qcloud_iotexplorer_bluetooth_adapter_llsync_1.LLSyncDeviceAdapterBase);exports.BleComboLLSyncDeviceAdapterBase=BleComboLLSyncDeviceAdapterBase,exports.BleComboLLSyncDeviceAdapter=qcloud_iotexplorer_bluetooth_adapter_1.AdapterDeviceAdapter4Mp(BleComboLLSyncDeviceAdapterBase),exports.BleComboLLSyncDeviceAdapter4H5=qcloud_iotexplorer_bluetooth_adapter_1.AdapterDeviceAdapter4H5(BleComboLLSyncDeviceAdapterBase);
//# sourceMappingURL=BleComboLLSyncDeviceAdapter.js.map
}, function(modId) { var map = {"./constants":1657335106829}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1657335106829, function(require, module, exports) {
var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.ATT_MTU_TO_LLSYNC_MTU_DELTA=exports.MIN_ATT_MTU=exports.BLE_COMBO_ERRORS=exports.GET_DEV_LOG_INFO_TIMEOUT=exports.GET_DEV_LOG_INFO_INVALID=exports.SET_WIFI_TOKEN_RESULT_TIMEOUT=exports.SET_WIFI_TOKEN_RESULT_INVALID=exports.SET_WIFI_CONNECT_RESULT_TIMEOUT=exports.SET_WIFI_CONNECT_RESULT_INVALID=exports.SET_WIFI_INFO_RESULT_TIMEOUT=exports.SET_WIFI_INFO_RESULT_INVALID=exports.SET_WIFI_MODE_RESULT_TIMEOUT=exports.SET_WIFI_MODE_RESULT_INVALID=void 0,exports.SET_WIFI_MODE_RESULT_INVALID="SET_WIFI_MODE_RESULT_INVALID",exports.SET_WIFI_MODE_RESULT_TIMEOUT="SET_WIFI_MODE_RESULT_TIMEOUT",exports.SET_WIFI_INFO_RESULT_INVALID="SET_WIFI_INFO_INVALID",exports.SET_WIFI_INFO_RESULT_TIMEOUT="SET_WIFI_INFO_TIMEOUT",exports.SET_WIFI_CONNECT_RESULT_INVALID="SET_WIFI_CONNECT_RESULT_INVALID",exports.SET_WIFI_CONNECT_RESULT_TIMEOUT="SET_WIFI_CONNECT_RESULT_TIMEOUT",exports.SET_WIFI_TOKEN_RESULT_INVALID="SET_WIFI_TOKEN_RESULT_INVALID",exports.SET_WIFI_TOKEN_RESULT_TIMEOUT="SET_WIFI_TOKEN_RESULT_TIMEOUT",exports.GET_DEV_LOG_INFO_INVALID="GET_DEV_LOG_INFO_INVALID",exports.GET_DEV_LOG_INFO_TIMEOUT="GET_DEV_LOG_INFO_TIMEOUT",exports.BLE_COMBO_ERRORS=((_a={})[exports.SET_WIFI_MODE_RESULT_INVALID]="设置WiFi模式返回格式错误",_a[exports.SET_WIFI_MODE_RESULT_TIMEOUT]="设置WiFi模式返回超时，请稍后再试",_a[exports.SET_WIFI_INFO_RESULT_INVALID]="WiFi信息传输返回格式错误",_a[exports.SET_WIFI_INFO_RESULT_TIMEOUT]="WiFi信息传输返回超时，请稍后再试",_a[exports.SET_WIFI_CONNECT_RESULT_INVALID]="WiFi连接失败",_a[exports.SET_WIFI_CONNECT_RESULT_TIMEOUT]="获取WiFi连接状态超时",_a[exports.SET_WIFI_TOKEN_RESULT_INVALID]="发送配网token结果非法",_a[exports.SET_WIFI_TOKEN_RESULT_TIMEOUT]="发送配网token结果超时，请稍后再试",_a[exports.GET_DEV_LOG_INFO_INVALID]="获取配网日志格式错误",_a[exports.GET_DEV_LOG_INFO_TIMEOUT]="获取配网日志超时，请稍后再试",_a),exports.MIN_ATT_MTU=23,exports.ATT_MTU_TO_LLSYNC_MTU_DELTA=3;
//# sourceMappingURL=constants.js.map
}, function(modId) { var map = {}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1657335106830, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0}),exports.BleComboLLSyncTask=void 0;var tslib_1=require("tslib"),constants_1=require("./constants"),BleComboTask_1=require("../BleComboTask"),BleComboLLSyncTask=function(e){function t(t){return e.call(this,t)||this}return tslib_1.__extends(t,e),t.prototype.setWiFiMode=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var e;return tslib_1.__generator(this,(function(t){switch(t.label){case 0:if(!this.deviceAdapter)throw new Error("deviceAdapter option is not provided to this plugin");return[4,this.deviceAdapter.setWiFiMode()];case 1:if(e=t.sent(),this.logger.info("setWiFiModeSucc",{success:e}),!e)throw{code:"BLE_SET_WIFI_MODE_ERROR"};return[2]}}))}))},t.prototype.sendWiFiInfo=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var e;return tslib_1.__generator(this,(function(t){switch(t.label){case 0:return[4,this.deviceAdapter.setWiFiInfo({ssid:this.ssid,password:this.password})];case 1:if(e=t.sent(),this.logger.info("sendWiFiInfo",{ssid:this.ssid,password:this.password,success:e}),!e)throw{code:"BLE_SEND_WIFI_INFO_ERROR",data:{ssid:this.ssid,password:this.password}};return[2]}}))}))},t.prototype.connectWifi=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var e,t,s,i;return tslib_1.__generator(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.deviceAdapter.sendConnectWiFiAndGetWiFiConnectState()];case 1:if(e=o.sent(),t=e.connected,s=e.ssid,console.log("----ssidData",s),t&&s.length&&s===this.ssid)return[2,s];throw{code:"BLE_WIFI_CONNECTION_ERROR",connected:t,ssidData:s};case 2:return i=o.sent(),console.error(i),[2,Promise.reject(tslib_1.__assign({msg:constants_1.BLE_COMBO_ERRORS[i.code]||""},i))];case 3:return[2]}}))}))},t.prototype.sendToken=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var e,t;return tslib_1.__generator(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this.deviceAdapter.sendToken({token:this.token})];case 1:if(e=s.sent(),this.logger.info("sendTokenSuccess",{success:e,token:this.token,productId:this.deviceAdapter.productId,deviceName:this.deviceAdapter.deviceName}),!e)throw{code:"BLE_SEND_TOKEN_ERROR",token:this.token};return[2,{productId:this.deviceAdapter.productId,deviceName:this.deviceAdapter.deviceName}];case 2:return t=s.sent(),console.error(t),[2,Promise.reject(tslib_1.__assign({msg:constants_1.BLE_COMBO_ERRORS[t.code]||""},t))];case 3:return[2]}}))}))},t}(BleComboTask_1.BleComboTask);exports.BleComboLLSyncTask=BleComboLLSyncTask;
//# sourceMappingURL=BleComboLLSyncTask.js.map
}, function(modId) { var map = {"./constants":1657335106829,"../BleComboTask":1657335106826}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1657335106831, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib");tslib_1.__exportStar(require("./BleComboDualModeDeviceAdapter"),exports);
//# sourceMappingURL=index.js.map
}, function(modId) { var map = {"./BleComboDualModeDeviceAdapter":1657335106832}; return __REQUIRE__(map[modId], modId); })
__DEFINE__(1657335106832, function(require, module, exports) {
Object.defineProperty(exports,"__esModule",{value:!0}),exports.BleComboDualModeDeviceAdapter4H5=exports.BleComboDualModeDeviceAdapter=exports.BleComboDualModeDeviceAdapterBase=void 0;var tslib_1=require("tslib"),BleComboLLSync_1=require("../BleComboLLSync"),qcloud_iotexplorer_bluetooth_adapter_1=require("qcloud-iotexplorer-bluetooth-adapter"),qcloud_iotexplorer_bluetooth_adapter_llsync_1=require("qcloud-iotexplorer-bluetooth-adapter-llsync"),hex2str=qcloud_iotexplorer_bluetooth_adapter_llsync_1.utils.hex2str,REPORT_EVENT_TYPE=qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.REPORT_EVENT_TYPE,arrayBufferToHexStringArray=qcloud_iotexplorer_bluetooth_adapter_1.blueToothHelper.arrayBufferToHexStringArray,DUALMODE_SERVICEID="0000FFE8-65D0-4E20-B56A-E493541BA4E2",DUALMODE_SERVICEID16="0000FFE8-0000-1000-8000-00805F9B34FB",LLSyncDualModeDeviceAdapter=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return tslib_1.__extends(t,e),t.serviceId16=DUALMODE_SERVICEID16,t.serviceId=DUALMODE_SERVICEID,t}(qcloud_iotexplorer_bluetooth_adapter_llsync_1.LLSyncDeviceAdapter),BleComboDualModeDeviceAdapterBase=function(e){function t(t){var o=e.call(this,t)||this;return o._bleDeviceAdapter=new LLSyncDualModeDeviceAdapter(t),o._bleDeviceAdapter.write=o.write.bind(o._bleDeviceAdapter),["PROPERTY_REPORT","CONTROL_REPLY","GET_STATUS","EVENT_REPORT","ACTION_REPLY","BIND_AUTH","CONNECT_AUTH","UNBIND_AUTH","DEVICE_INFO","UPDATE_REPLY","UPDATE_DATA_REPLY","UPDATE_DATA_CHECK_REPLY","MTU_MODULE_CALLBACK","USER_CHECK_TIMEOUT_CALLBACK","REGISTER_DEVICE_INFO_REPLY"].forEach((function(e){o.on(e,(function(){for(var t,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];console.info("[dualmodeDeviceAdapter] emit "+e+" from dualmode adapter",r),(t=o._bleDeviceAdapter).emit.apply(t,tslib_1.__spread([e],r))}))})),o.on("connect",(function(e){console.info("ble connected",e),o._bleDeviceAdapter._deviceConnected=!0,o._bleDeviceAdapter.emit("connect")})),o.on("disconnect",(function(e){console.info("ble disconnect",e),o._bleDeviceAdapter._deviceConnected=!1,o._bleDeviceAdapter.emit("disconnect")})),o}return tslib_1.__extends(t,e),t.injectOptions=function(e){exports.BleComboDualModeDeviceAdapter.options=e,qcloud_iotexplorer_bluetooth_adapter_llsync_1.LLSyncDeviceAdapter.injectOptions(e)},t.prototype.toString=function(){return"[BleComboDualModeDeviceAdapter]"},Object.defineProperty(t.prototype,"authorized",{get:function(){return this._bleDeviceAdapter.authorized},enumerable:!1,configurable:!0}),t.prototype.authenticateConnection=function(e){return this._bleDeviceAdapter.authenticateConnection(e)},t.prototype.bindDevice=function(e){return this._bleDeviceAdapter.bindDevice(e)},t.prototype.unbindDevice=function(e){return this._bleDeviceAdapter.unbindDevice.call(this._bleDeviceAdapter,e)},t.prototype.controlDevice=function(e){return this._bleDeviceAdapter.controlDevice.call(this._bleDeviceAdapter,e)},t.prototype.init=function(){return this._bleDeviceAdapter.init()},t.serviceId16=DUALMODE_SERVICEID16,t.serviceId=DUALMODE_SERVICEID,t.deviceFilter=function(e,t){var o,r,i;if(!e.advertisServiceUUIDs||!e.advertisServiceUUIDs.find((function(e){return e===exports.BleComboDualModeDeviceAdapter.serviceId16}))||!e.advertisData)return null;try{var l=Math.floor(10*Math.random())%10==1||!0,a=arrayBufferToHexStringArray(e.advertisData);l&&(null===(o=exports.BleComboDualModeDeviceAdapter.options.appDevSdk.reporter)||void 0===o||o.info(REPORT_EVENT_TYPE,{message:"收到广播",serviceId:exports.BleComboDualModeDeviceAdapter.serviceId,hexArr:a.join(",")}));var c=parseInt(a[2],16)-(parseInt(a[2],16)>>2<<2),n=parseInt(a[2],16)>>4,d=t.productId&&t.deviceName?t.productId+"/"+t.deviceName:"",_=d?qcloud_iotexplorer_bluetooth_adapter_llsync_1.utils.get8ByteFromStr(""+d.replace("/","")):"",p=!!d,s="",u="",D="",v=qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.DEVICE_STATE_MAP[c],E=[qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.DEVICE_HAS_BINDED,qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.DEVICE_HAS_CONNECTED].indexOf(v)>-1;if(E)D=a.slice(3,11).join("").toLocaleLowerCase(),u=a.slice(11).join("").toLocaleLowerCase(),s=t.productId;else{var A=a.slice(3,9);e.name&&-1===e.name.indexOf("_")&&(e.name=e.name+"_"+A.slice(0,2).join("")),s=hex2str(a.slice(9))}l&&(null===(r=exports.BleComboDualModeDeviceAdapter.options.appDevSdk.reporter)||void 0===r||r.info(REPORT_EVENT_TYPE,{message:"解析广播",serviceId:exports.BleComboDualModeDeviceAdapter.serviceId,data:{bindState:v||"x",targetDeviceId:d,targetDeviceIdentify:_,deviceUserIdentify:u||"x",deviceProductId:s||"x",deviceIdentify:D||"x"}}));var b=function(){var o=tslib_1.__assign(tslib_1.__assign({},e),{standard:!0,bindState:qcloud_iotexplorer_bluetooth_adapter_llsync_1.constants.DEVICE_STATE_MAP[v],serviceId:exports.BleComboDualModeDeviceAdapter.serviceId,deviceName:t.deviceName||"",productId:s,extendInfo:{moduleVersion:n}});return console.log("---设备匹配成功---",o),o};return p&&E&&D===_?b():p||E?null:b()}catch(e){console.error("llsync device filter error",e),null===(i=exports.BleComboDualModeDeviceAdapter.options.appDevSdk.reporter)||void 0===i||i.error(REPORT_EVENT_TYPE,{message:"协议广播出错",error:e})}},t}(BleComboLLSync_1.BleComboLLSyncDeviceAdapterBase);exports.BleComboDualModeDeviceAdapterBase=BleComboDualModeDeviceAdapterBase,exports.BleComboDualModeDeviceAdapter=qcloud_iotexplorer_bluetooth_adapter_1.AdapterDeviceAdapter4Mp(BleComboDualModeDeviceAdapterBase),exports.BleComboDualModeDeviceAdapter4H5=qcloud_iotexplorer_bluetooth_adapter_1.AdapterDeviceAdapter4H5(BleComboDualModeDeviceAdapterBase);
//# sourceMappingURL=BleComboDualModeDeviceAdapter.js.map
}, function(modId) { var map = {"../BleComboLLSync":1657335106827}; return __REQUIRE__(map[modId], modId); })
return __REQUIRE__(1657335106820);
})()
//# sourceMappingURL=index.js.map