"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CancelableQueue=void 0;var tslib_1=require("tslib"),SimpleQueue_1=require("./SimpleQueue"),CancelableQueue=function(e){function t(t){var n,u,i=e.call(this,tslib_1.__assign(tslib_1.__assign({},t),{handler:function(e){return i.handleCancelableTask(t.handler,e)}}))||this;return i.timeout=null,i.timeoutCode=null,i.timeout=null!==(n=t.timeout)&&void 0!==n?n:null,i.timeoutCode=null!==(u=t.timeoutCode)&&void 0!==u?u:null,i}return tslib_1.__extends(t,e),t.prototype.push=function(e){var t,n=this.getTaskId(),u=!1,i=new Promise((function(e,n){t=function(e){u=!0,n(e)}}));return this.queue.push({taskId:n,businessData:e,cancel:t,cancelPromise:i,isCancelled:function(){return u}}),this.autoStart&&this.start(),{taskId:n,cancel:t}},t.prototype.cancelAllTasks=function(e){this.runningTask&&this.runningTask.cancel(e),this.queue.forEach((function(t){t.cancel(e)}))},t.prototype.handleCancelableTask=function(e,t){var n=this;if(t.isCancelled())return t.cancelPromise;var u=e(t),i=[t.cancelPromise,u];if(null!==this.timeout){var l,a=new Promise((function(e,t){l=setTimeout((function(){t({code:n.timeoutCode})}),n.timeout)})),r=function(){clearTimeout(l)};return Promise.race(i).then(r,r),Promise.race(tslib_1.__spread([a],i))}return Promise.race(i)},t}(SimpleQueue_1.SimpleQueue);exports.CancelableQueue=CancelableQueue;
//# sourceMappingURL=CancelableQueue.js.map