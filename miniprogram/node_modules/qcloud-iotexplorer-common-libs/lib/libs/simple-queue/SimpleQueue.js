"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SimpleQueue=void 0;var tslib_1=require("tslib"),SimpleQueue=function(){function t(t){var s=t.autoStart,e=void 0===s||s,r=t.handler,n=t.onTaskSuccess,i=t.onTaskError;if(this.taskIdCount=0,this.inBusy=!1,this.startExecute=!1,this.runningTask=null,"function"!=typeof r)throw"params handler is not a function";this.autoStart=e,this.handler=r,this.onTaskSuccess=n,this.onTaskError=i,this.queue=[]}return t.prototype.push=function(t){var s=this.getTaskId();return this.queue.push({taskId:s,businessData:t}),this.autoStart&&this.start(),{taskId:s}},t.prototype.start=function(){this.startExecute=!0,this.consumeTask()},t.prototype.remove=function(t){var s=this.queue.findIndex((function(s){return s.taskId===t}));-1!==s&&this.queue.splice(s,1)},t.prototype.stop=function(){this.startExecute=!1},t.prototype.clear=function(){this.stop(),this.queue=[]},t.prototype.consumeTask=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var t,s,e;return tslib_1.__generator(this,(function(r){switch(r.label){case 0:if(!this.startExecute||this.inBusy||this.queue.length<=0)return[2];t=this.queue.shift(),this.inBusy=!0,this.runningTask=t,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.handler(t)];case 2:s=r.sent();try{"function"==typeof this.onTaskSuccess&&this.onTaskSuccess(t,s)}catch(t){}return[3,4];case 3:e=r.sent(),console.error("simple queue execute handler error",e);try{"function"==typeof this.onTaskError&&this.onTaskError(e,t)}catch(t){}return[3,4];case 4:return this.runningTask=null,this.inBusy=!1,this.consumeTask(),[2]}}))}))},t.prototype.getTaskId=function(){return String(++this.taskIdCount)},t}();exports.SimpleQueue=SimpleQueue;
//# sourceMappingURL=SimpleQueue.js.map