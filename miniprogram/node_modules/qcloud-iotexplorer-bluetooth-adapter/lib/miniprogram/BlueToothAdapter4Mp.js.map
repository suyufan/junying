{"version":3,"sources":["../../src/miniprogram/BlueToothAdapter4Mp.ts"],"names":["base_1","require","qcloud_iotexplorer_appdev_sdk_1","_a","AppDevSdk","utils","arrayBufferToHexStringArray","hexToArrayBuffer","parseAdvertisData","device","result","tslib_1","__assign","advertisData","err","console","error","BlueToothAdapter4Mp","_super","bluetoothApi","props","__rest","_this","call","this","_h5ChanelOpened","_localDiscoveringInUse","_h5DiscoveringInUse","_cleanupTimer","_currentProductId","handleH5WsMessage","deviceDelayDisconnectQueue","_mpBleConnectionStateCache","_h5Websocket","on","available","discovering","response2BlueToothChanel","data","reqId","log","action","payload","connected","explorerDeviceId","deviceId","onDeviceConnectStatusChange","_c","devices","forEach","actualConnected","deviceName","productId","_actions","bindDevice","devMode","_e","sent","code","err_1","registerDevice","err_2","stopBluetoothDevicesDiscovery","init","err_3","api","params","tryCancelDisconnectDevice","_bluetoothApi","createBLEConnection","getBluetoothDevices","map","value","writeBLECharacteristicValue","resp","startBluetoothDevicesDiscovery","err_4","_normalizeError","wx","success","fail","__extends","prototype","targetDeviceDisconnectOrderIndex","findIndex","item","targetDeviceDisconnectOrder","clearTimeout","timer","splice","disconnectDevice","delay","deviceConnectStatus","_deviceConnectStatusStore","get","setTimeout","closeBLEConnection","push","getAll","setCurrentProduct","isFromH5","send","warn","err_5","startCleanupTimer","connectedDeviceList","_deviceAdapterStore","filter","isConnected","_discovering","length","cleanup","then","onBleConnectionStateChange","onBLECharacteristicValueChange","serviceId","characteristicId","onBluetoothDeviceFound","startSearch","searchDevice","deviceInfo","BlueToothAdapter","exports"],"mappings":"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"}