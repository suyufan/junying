"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BlueToothBridge=void 0;var tslib_1=require("tslib"),event_emitter_for_miniprogram_1=tslib_1.__importDefault(require("event-emitter-for-miniprogram")),qcloud_iotexplorer_appdev_sdk_1=require("qcloud-iotexplorer-appdev-sdk"),tryCallHandler=qcloud_iotexplorer_appdev_sdk_1.AppDevSdk.utils.tryCallHandler,BlueToothBridge=function(t){function e(e){var o=e.h5Websocket,n=t.call(this)||this;return n._h5Websocket=null,n._blueToothBridgeEnable=!1,n._h5Websocket=o,n._h5Websocket.on("message",(function(t){var e=t.action,o=t.payload;return tslib_1.__awaiter(n,void 0,void 0,(function(){return tslib_1.__generator(this,(function(t){switch(t.label){case 0:switch(e){case"connect":return[3,1];case"onBluetoothAdapterStateChange":return[3,5];case"onBLEConnectionStateChange":return[3,6];case"onBLECharacteristicValueChange":return[3,7];case"onBluetoothDeviceFound":return[3,8]}return[3,9];case 1:return this._blueToothBridgeEnable?[4,this._h5Websocket.connect()]:[3,4];case 2:return t.sent(),[4,this.init()];case 3:t.sent(),t.label=4;case 4:return[3,9];case 5:return tryCallHandler(this,"onBluetoothAdapterStateChange",o),[3,9];case 6:return tryCallHandler(this,"onBLEConnectionStateChange",o),[3,9];case 7:return tryCallHandler(this,"onBLECharacteristicValueChange",o),[3,9];case 8:return tryCallHandler(this,"onBluetoothDeviceFound",o),[3,9];case 9:return[2]}}))}))})),n}return tslib_1.__extends(e,t),e.prototype.init=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){return tslib_1.__generator(this,(function(t){switch(t.label){case 0:return this._blueToothBridgeEnable=!0,[4,this._h5Websocket.send("Control",{action:"init"})];case 1:return t.sent(),[2]}}))}))},e.prototype.openBluetoothAdapter=function(){return this.init()},e.prototype.control=function(t,e){return this._h5Websocket.send("Control",{action:t,payload:e})},e.prototype.callWxApi=function(t,e){return tslib_1.__awaiter(this,void 0,void 0,(function(){var o,n;return tslib_1.__generator(this,(function(r){switch(r.label){case 0:return o=Date.now(),[4,this.control("callApi",{api:t,params:e})];case 1:return n=r.sent(),console.log("[BlueToothBridge] call Wx api: "+t+" success, time cost: "+(Date.now()-o)+"ms"),[2,n]}}))}))},e.prototype.stopBluetoothDevicesDiscovery=function(t){return this.callWxApi("stopBluetoothDevicesDiscovery",t)},e.prototype.startBluetoothDevicesDiscovery=function(t){return this.callWxApi("startBluetoothDevicesDiscovery",t)},e.prototype.getConnectedBluetoothDevices=function(t){return this.callWxApi("getConnectedBluetoothDevices",t)},e.prototype.getBluetoothDevices=function(t){return this.callWxApi("getBluetoothDevices",t)},e.prototype.getBluetoothAdapterState=function(t){return this.callWxApi("getBluetoothAdapterState",t)},e.prototype.writeBLECharacteristicValue=function(t){return this.callWxApi("writeBLECharacteristicValue",t)},e.prototype.setBLEMTU=function(t){return this.callWxApi("setBLEMTU",t)},e.prototype.readBLECharacteristicValue=function(t){return this.callWxApi("readBLECharacteristicValue",t)},e.prototype.notifyBLECharacteristicValueChange=function(t){return this.callWxApi("notifyBLECharacteristicValueChange",t)},e.prototype.getBLEDeviceServices=function(t){return this.callWxApi("getBLEDeviceServices",t)},e.prototype.getBLEDeviceRSSI=function(t){return this.callWxApi("getBLEDeviceRSSI",t)},e.prototype.getBLEDeviceCharacteristics=function(t){return this.callWxApi("getBLEDeviceCharacteristics",t)},e.prototype.createBLEConnection=function(t){return tslib_1.__awaiter(this,void 0,void 0,(function(){return tslib_1.__generator(this,(function(e){return[2,this.callWxApi("createBLEConnection",t)]}))}))},e.prototype.closeBLEConnection=function(t){return this.callWxApi("closeBLEConnection",t)},e.prototype.onBluetoothAdapterStateChange=function(t){this._onBluetoothAdapterStateChangeHandler=t},e.prototype.offBluetoothAdapterStateChange=function(){this._onBluetoothAdapterStateChangeHandler=null},e.prototype.onBLEConnectionStateChange=function(t){this._onBLEConnectionStateChangeHandler=t},e.prototype.offBLEConnectionStateChange=function(){this._onBLEConnectionStateChangeHandler=null},e.prototype.onBLECharacteristicValueChange=function(t){this._onBLECharacteristicValueChangeHandler=t},e.prototype.offBLECharacteristicValueChange=function(){this._onBLECharacteristicValueChangeHandler=null},e.prototype.onBluetoothDeviceFound=function(t){this._onBluetoothDeviceFoundHandler=t},e.prototype.offBluetoothDeviceFound=function(){this._onBluetoothDeviceFoundHandler=null},e.prototype.getSystemInfo=function(t){var e=(void 0===t?{}:t).useCache,o=void 0===e||e;return tslib_1.__awaiter(this,void 0,void 0,(function(){var t;return tslib_1.__generator(this,(function(e){switch(e.label){case 0:return this._systemInfoCache&&o?[2,this._systemInfoCache]:(t=this,[4,this.callWxApi("getSystemInfo",{})]);case 1:return t._systemInfoCache=e.sent(),[2,this._systemInfoCache]}}))}))},e.prototype.closeBluetoothAdapter=function(){},e}(event_emitter_for_miniprogram_1.default);exports.BlueToothBridge=BlueToothBridge;
//# sourceMappingURL=BlueToothBridge.js.map