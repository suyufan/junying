"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _systemInfoCache,tslib_1=require("tslib"),qcloud_iotexplorer_appdev_sdk_1=require("qcloud-iotexplorer-appdev-sdk"),pify=qcloud_iotexplorer_appdev_sdk_1.AppDevSdk.utils.pify,pifyApiArr=["closeBluetoothAdapter","stopBluetoothDevicesDiscovery","readBLECharacteristicValue","getBluetoothAdapterState","getBluetoothDevices","startBluetoothDevicesDiscovery","closeBLEConnection","getBLEDeviceServices","getBLEDeviceCharacteristics","notifyBLECharacteristicValueChange","writeBLECharacteristicValue","setBLEMTU"],callbackApiArr=["onBluetoothAdapterStateChange","onBLEConnectionStateChange","onBLECharacteristicValueChange","onBluetoothDeviceFound","onBLEPeripheralConnectionStateChanged","offBluetoothAdapterStateChange","offBLEConnectionStateChange","offBLECharacteristicValueChange","offBluetoothDeviceFound","offBLEPeripheralConnectionStateChanged"],pifyPeripheralApiArr=["addService","close","removeService","startAdvertising","stopAdvertising","writeCharacteristicValue"],callbackPeripheralApiArr=["onCharacteristicReadRequest","onCharacteristicSubscribed","onCharacteristicUnsubscribed","onCharacteristicWriteRequest","offCharacteristicReadRequest","offCharacteristicSubscribed","offCharacteristicUnsubscribed","offCharacteristicWriteRequest"],apis={};pifyApiArr.forEach((function(e){apis[e]=function(t){return pify(wx[e])(t)}})),callbackApiArr.forEach((function(e){apis[e]=function(t){return wx[e](t)}})),apis.createBLEConnection=function(e,t){var r=(void 0===t?{}:t).isRetry,i=void 0!==r&&r;return tslib_1.__awaiter(void 0,void 0,void 0,(function(){var t;return tslib_1.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,pify(wx.createBLEConnection)(e)];case 1:return r.sent(),[3,3];case 2:return t=r.sent(),!i&&t&&t.errMsg&&t.errMsg.indexOf("already connect")>-1?(console.log("device is already connected, resolve directly"),[2,Promise.resolve()]):[2,Promise.reject(t)];case 3:return[2]}}))}))},apis.createBLEPeripheralServer=function(e){return tslib_1.__awaiter(void 0,void 0,void 0,(function(){var t,r;return tslib_1.__generator(this,(function(i){switch(i.label){case 0:return[4,pify(wx.createBLEPeripheralServer)(e)];case 1:return t=i.sent().server,r={},pifyPeripheralApiArr.forEach((function(e){r[e]=function(r){return pify(t[e],t)(r)}})),callbackPeripheralApiArr.forEach((function(e){r[e]=function(r){return t[e](r)}})),[2,r]}}))}))},apis.openBluetoothAdapter=function(e){return tslib_1.__awaiter(void 0,void 0,void 0,(function(){var t,r;return tslib_1.__generator(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,apis.getSystemInfo({useCache:!1})];case 1:if((null==(t=i.sent())?void 0:t.platform)&&t.platform.toLowerCase().indexOf("android")>-1){if(!(null==t?void 0:t.locationEnabled))throw{code:"Location:Disable",msg:"请打开系统地理位置开关"};if(!(null==t?void 0:t.locationAuthorized))throw{code:"Location:UnAuthorized",msg:"请到系统设置授予微信使用地理位置权限"}}return[4,pify(wx.openBluetoothAdapter)(e)];case 2:return i.sent(),[3,4];case 3:if(3===(null==(r=i.sent())?void 0:r.state))throw{code:null==r?void 0:r.errCode,msg:"请到系统设置授权微信使用蓝牙权限"};throw r;case 4:return[2]}}))}))},apis.getSystemInfo=function(e){var t=(void 0===e?{}:e).useCache,r=void 0===t||t;return tslib_1.__awaiter(void 0,void 0,void 0,(function(){return tslib_1.__generator(this,(function(e){switch(e.label){case 0:return _systemInfoCache&&r?[2,_systemInfoCache]:[4,pify(wx.getSystemInfo)()];case 1:return[2,_systemInfoCache=e.sent()]}}))}))},exports.default=apis;
//# sourceMappingURL=nativeBluetoothApi.js.map