"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BleComboEspTask=void 0;var tslib_1=require("tslib"),qcloud_iotexplorer_appdev_sdk_1=require("qcloud-iotexplorer-appdev-sdk"),constants_1=require("./constants"),BleComboTask_1=require("../BleComboTask"),_a=qcloud_iotexplorer_appdev_sdk_1.AppDevSdk.utils,byteUtil=_a.byteUtil,delay=_a.delay,BleComboEspTask=function(e){function t(t){return e.call(this,t)||this}return tslib_1.__extends(t,e),t.prototype.setWiFiMode=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var e;return tslib_1.__generator(this,(function(t){switch(t.label){case 0:return[4,this.deviceAdapter.sendSwitchWiFi()];case 1:return e=t.sent(),this.logger.info("sendSwitchWiFiSucc",{bleData:e}),[2]}}))}))},t.prototype.sendWiFiInfo=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var e,t;return tslib_1.__generator(this,(function(s){switch(s.label){case 0:return[4,this.deviceAdapter.sendSsid(this.ssid)];case 1:return e=s.sent(),this.logger.info("sendSsidSucc",{bleData:e}),[4,delay(this.sendDataInterval)];case 2:return s.sent(),[4,this.deviceAdapter.sendPassword(this.password)];case 3:return t=s.sent(),this.logger.info("sendPasswordSucc",{bleData:t}),[2]}}))}))},t.prototype.connectWifi=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var e,t,s;return tslib_1.__generator(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.deviceAdapter.getWifiConnectState()];case 1:if(e=i.sent(),t=byteUtil.byteArrayToHex(byteUtil.getBytesByString(this.ssid)).toUpperCase(),console.log("----ssidData",e),e.length&&e.join("")===t)return[2,e];throw{code:"BLE_WIFI_CONNECTION_ERROR",ssidData:e.join(""),correctSsidData:t};case 2:return s=i.sent(),console.error(s),[2,Promise.reject(tslib_1.__assign(tslib_1.__assign({},s),{code:"BLE_WIFI_CONNECTION_"+(s.code||"ERROR")}))];case 3:return[2]}}))}))},t.prototype.sendToken=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var e,t;return tslib_1.__generator(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this.deviceAdapter.getCustomData({mode:constants_1.DATA_MODE,subType:constants_1.SEND_TOKEN_SUB_TYPE,data:this.token})];case 1:return e=s.sent(),this.logger.info("deviceData",{deviceData:e}),this.interrupt(),[2,{productId:e.productId,deviceName:e.deviceName}];case 2:return t=s.sent(),[2,Promise.reject(tslib_1.__assign({code:"BLE_TOKEN_STATE_"+(t.code||"ERROR")},t))];case 3:return[2]}}))}))},t}(BleComboTask_1.BleComboTask);exports.BleComboEspTask=BleComboEspTask;
//# sourceMappingURL=BleComboEspTask.js.map