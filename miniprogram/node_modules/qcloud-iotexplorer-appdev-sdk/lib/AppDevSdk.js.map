{"version":3,"sources":["../src/AppDevSdk.ts"],"names":["event_emitter_for_miniprogram_1","tslib_1","__importDefault","require","modules_1","utils_1","utils","__importStar","constants","ReportLevel","INFO","WARN","ERROR","AppDevPlugin","install","sdk","exports","AppDevSdk","_super","_a","getAccessToken","_b","appKey","_c","apiPlatform","_d","apiRegionId","_e","debug","apiUrl","wsConfigExtended","wsConfig","reporter","_f","plugins","_g","defaultUin","_h","enableAccessTokenCache","_this","call","this","isManuallyClose","_defaultFamilyIdPromise","_connectWsWhenInit","_defaultUin","_apiUrl","_debug","logger","config","reporterInstance","noop","info","eventName","params","__assign","level","err","warn","error","_j","_k","autoReconnect","_l","disconnectWhenAppHide","_m","connectWhenAppShow","_o","connectWhenInit","__rest","ws","IotWebsocket","loginManager","LoginManager","_apiPlatform","_apiRegionId","on","EventTypes","LoginStateChange","isLogin","emit","WsError","_reconnectWs","code","reason","WsClose","_onWebsocketClose","pushEvent","_handlePushEvent","envDetect","isMiniProgram","wx","onAppHide","disconnect","onAppShow","connect","length","forEach","plugin","usePlugin","__extends","prototype","Object","defineProperty","userInfo","userId","nickName","init","options","reload","_initPromise","Promise","resolve","reject","__awaiter","login","sent","normalizeError","err_1","getDefaultFamilyId","requestApi","Offset","Limit","FamilyList","Total","Name","FamilyId","Data","err_2","sendWebsocketMessage","action","send","connectWebsocket","disconnectWebsocket","subscribeDevices","deviceList","map","item","DeviceId","filter","Boolean","err_3","Action","payload","doNotRetry","needLogin","doNotReport","opts","checkLogin","accessToken","uin","RegionId","AccessToken","Platform","requestTokenApi","url","err_4","isVerifyLoginError","reLogin","reLoginError_1","genVerifyLoginFailError","WsPush","Type","SubType","Time","Payload","updateTime","Date","getTime","JSON","parse","base64","decode","deviceData","method","deviceDataParams","type","state","reported","__values","keys","next","done","key","value","Value","lastUpdate","LastUpdate","WsReport","deviceId","WsControl","WsEventReport","WsActionPush","WsActionReport","WsDeviceBind","WsDeviceUnbind","DeviceStatus","WsStatusChange","deviceStatus","console","WsSubDeviceBind","gatewayDeviceId","subDeviceList","WsSubDeviceChange","WsSubDeviceUnbind","delay","err_5","default"],"mappings":"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"}