"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FileSdkForH5=void 0;var tslib_1=require("tslib"),FileSdk_1=tslib_1.__importDefault(require("./FileSdk")),spark_md5_1=tslib_1.__importDefault(require("spark-md5")),FileSdkForH5=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return tslib_1.__extends(t,e),t.prototype.appGetResourceUploadURL=function(t){return tslib_1.__awaiter(this,void 0,void 0,(function(){var r,i,s=this;return tslib_1.__generator(this,(function(o){switch(o.label){case 0:return t?(r=this.getfileHash(t),i="",[4,r.then((function(r){return tslib_1.__awaiter(s,void 0,void 0,(function(){var s;return tslib_1.__generator(this,(function(o){switch(o.label){case 0:return[4,e.prototype.getResourceUploadURL.call(this,t,r,this.sdk.productId)];case 1:return s=o.sent(),this.handleUpload(null==s?void 0:s.UploadUrl,t,r),i=null==s?void 0:s.ResourceName,[2]}}))}))}))]):(this.sdk.tips.showError("请先选择文件"),[2]);case 1:return o.sent(),[2,{ResourceName:i}]}}))}))},t.prototype.handleUpload=function(t,r,i){var s=this,o=new XMLHttpRequest;o.open("PUT",t,!0),o.onreadystatechange=function(){return tslib_1.__awaiter(s,void 0,void 0,(function(){var t;return tslib_1.__generator(this,(function(s){switch(s.label){case 0:if(4!==o.readyState||200!==o.status)return[3,4];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,e.prototype.createResource.call(this,r,i,this.sdk.productId)];case 2:return s.sent().ResourceName&&this.sdk.tips.showSuccess("文件上传成功"),[3,4];case 3:return t=s.sent(),this.sdk.tips.showError("上传失败,"+t.msg),[3,4];case 4:return[2]}}))}))},o.send(r)},t.prototype.getfileHash=function(e){var t=this;return new Promise((function(r){var i=new spark_md5_1.default.ArrayBuffer,s=new FileReader;s.onload=function(e){if(null==e?void 0:e.target){var t=e.target.result;i.append(t),r(i.end())}},s.onerror=function(){t.sdk.tips.showError("上传文件错误"+s.error)},s.readAsArrayBuffer(e)}))},t.prototype.handelDownToDevice=function(t){return tslib_1.__awaiter(this,void 0,void 0,(function(){return tslib_1.__generator(this,(function(r){switch(r.label){case 0:return[4,e.prototype.controlDeviceResource.call(this,t,this.sdk.deviceId)];case 1:return r.sent(),this.sdk.tips.showLoading("文件下发中",{type:"loading",canBeReplace:!0,duration:0,delayDuration:200,canClickClose:!1}),[2,e.prototype.getDeviceResource.call(this,t,this.sdk.deviceId)]}}))}))},t}(FileSdk_1.default);exports.FileSdkForH5=FileSdkForH5;
//# sourceMappingURL=FileSdkForH5.js.map